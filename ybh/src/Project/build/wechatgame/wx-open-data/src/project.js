window.__require=function e(t,n,a){function i(o,s){if(!n[o]){if(!t[o]){var c=o.split("/");if(c=c[c.length-1],!t[c]){var d="function"==typeof __require&&__require;if(!s&&d)return d(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+o+"'")}}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){return i(t[o][1][e]||e)},l,l.exports,e,t,n,a)}return n[o].exports}for(var r="function"==typeof __require&&__require,o=0;o<a.length;o++)i(a[o]);return i}({BalancePassedView:[function(e,t,n){"use strict";cc._RF.push(t,"84d2cTpPWpKfqJ61MNZ7Q5f","BalancePassedView");var a=function(e){return e&&e.__esModule?e:{default:e}}(e("./Util"));t.exports=cc.Class({extends:cc.Component,properties:{heads:[cc.Node],label_time:[cc.Label]},onLoad:function(){},updatePoint:function(e){var t=this,n=(e.pointId,e.costTime);this.costTime=n,Promise.all([a.default.getWeChatUserInfo(),a.default.getWXFriendRanks()]).then(function(e){var n=e[0],a=e[1];if(a&&n){for(var i=0,r=0;r<a.length;r++)if(a[r].nickname===n[0].nickName&&a[r].avatarUrl===n[0].avatarUrl){i=r;break}t.ranks=[],0===i?t.ranks=[a[i],a[i+1],a[i+2]]:i===a.length-1?t.ranks=[a[i-2],a[i-1],a[i]]:t.ranks=[a[i-1],a[i],a[i+1]],t.updateHeads()}}).catch(function(e){console.log("3e = ",e)})},updateHeads:function(){for(var e=0;e<3&&this.ranks[e];e++)this.heads[e].active=!0,this.heads[e].getComponent("PhotoPrefab").setPhoto(this.ranks[e].avatarUrl),this.label_time[e].string=this.ranks[e].score+"\u5173"}}),cc._RF.pop()},{"./Util":"Util"}],DataMain:[function(e,t,n){"use strict";cc._RF.push(t,"4f503fb6ThPJanpxGIbu6te","DataMain");var a=o(e("./Script/BalancePassedView")),i=o(e("./Script/FriendPassedView")),r=o(e("./Script/Util"));function o(e){return e&&e.__esModule?e:{default:e}}cc.Class({extends:cc.Component,properties:{ranks:cc.Node,RankItemPre:cc.Prefab,Balance:cc.Node,Friend:cc.Node},start:function(){if(this.isWxApp()){var e=this;wx.onMessage(function(t){if(console.log("\u6536\u5230\u4e3b\u57df\u6d88\u606f",t,e),t.cmd)if(2===t.cmd){if(console.log("\u663e\u793a\u6392\u884c\u699c",e.ranks),e.setUI(1,0,0),t.data.isAllScreen){var n=e.ranks.getComponent(cc.Widget);n.top=3,n.bottom=100,n.updateAlignment(),e.ranks.getChildByName("view").getComponent(cc.Widget).updateAlignment()}e.requestDataFromServer()}else 3===t.cmd?(console.log("\u663e\u793a\u53f3\u4e0a\u89d2 = ",e.Friend),e.setUI(0,0,1),e.showFriendPass(t.data)):4===t.cmd&&(console.log("\u663e\u793a\u4e2d\u95f4"),e.setUI(0,1,0),e.showBalancePass(t.data));else e.setUI(0,0,0)})}},setUI:function(e,t,n){this.ranks.active=1===e,this.Balance.active=1===t,this.Friend.active=1===n},requestDataFromServer:function(){var e=this;r.default.getWXFriendRanks().then(function(t){t&&e.renderRank(t)})},renderRank:function(e){var t=e;console.log("ranks = ",this.ranks);var n=this.ranks.getChildByName("view").getChildByName("content");n.destroyAllChildren();for(var a=0;a<t.length;a++){var i=cc.instantiate(this.RankItemPre);n.addChild(i),i.getComponent("RankItemPrefab").setPlayerInfo(a+1,t[a].avatarUrl,t[a].nickname,t[a].score,!1),i.height=108}},isWxApp:function(){return"undefined"!=typeof wx},showFriendPass:function(e){this.Friend.getComponent(i.default).updatePoint(e.pointId)},showBalancePass:function(e){this.Balance.getComponent(a.default).updatePoint(e)}}),cc._RF.pop()},{"./Script/BalancePassedView":"BalancePassedView","./Script/FriendPassedView":"FriendPassedView","./Script/Util":"Util"}],FriendPassedView:[function(e,t,n){"use strict";cc._RF.push(t,"7819ffsC61D3qIWkDZsVmkL","FriendPassedView");var a=function(e){return e&&e.__esModule?e:{default:e}}(e("./Util"));t.exports=cc.Class({extends:cc.Component,properties:{heads:[cc.Node]},onLoad:function(){},updatePoint:function(e){var t=this;a.default.getWXFriendRanks().then(function(n){n&&(t.list=n,t.updateHeads(e))})},updateHeads:function(e){if(this.node&&this.node.active)for(var t=0;t<3&&t<this.list.length;t++)this.list[t].score>=e?(this.heads[t].active=!0,this.heads[t].getComponent("PhotoPrefab").setPhoto(this.list[t].avatarUrl)):this.heads[t].getComponent("PhotoPrefab").clearPhoto()}}),cc._RF.pop()},{"./Util":"Util"}],PhotoPrefab:[function(e,t,n){"use strict";cc._RF.push(t,"aac95RGVLNLaYP/xE7cqGS+","PhotoPrefab"),cc.Class({extends:cc.Component,properties:{photo:{default:null,type:cc.Node,displayName:"\u5934\u50cf"}},onLoad:function(){},setPhoto:function(e){this.photo.active=!0,this.loadPhoto(this.photo,e)},clearPhoto:function(){(this.photo.getChildByName("photo")||this.photo.getChildByName("mask").getChildByName("photo")).getComponent(cc.Sprite).spriteFrame=null},loadPhoto:function(e,t){if(t){var n=(e.getChildByName("photo")||e.getChildByName("mask").getChildByName("photo")).getComponent(cc.Sprite);cc.loader.load({url:t,type:"jpg"},function(e,t){e?console.log("err: PhotoPrefab.js loadPhoto ",e):n&&void 0!==n.spriteFrame?n.spriteFrame=new cc.SpriteFrame(t):cc.error("\u5934\u50cf\u52a0\u8f7d\u5931\u8d25",e)})}}}),cc._RF.pop()},{}],RankItemPrefab:[function(e,t,n){"use strict";cc._RF.push(t,"bec1aY3wNhO46YS8rs/CzGc","RankItemPrefab"),cc.Class({extends:cc.Component,properties:{BgFrames:{default:[],type:cc.SpriteFrame},bg:cc.Sprite,playername:cc.Label,playerscore:cc.Label,rank:cc.Label,head:cc.Node},setPlayerInfo:function(e,t,n,a,i){i?(this.bg.spriteFrame=this.BgFrames[4],this.rank.node.active=!0,this.rank.string=cc.js.formatStr("%d",e),this.playername.string="\u6211",this.playername.node.active=!0):(e>=1&&e<=3?(this.bg.spriteFrame=this.BgFrames[e],this.rank.node.active=!1):(this.bg.spriteFrame=this.BgFrames[0],this.rank.node.active=!0,this.rank.string=cc.js.formatStr("%d",e)),this.playername.string=n),this.playerscore.string=a,this.head.getComponent("PhotoPrefab").setPhoto(t)}}),cc._RF.pop()},{}],Util:[function(e,t,n){"use strict";cc._RF.push(t,"6fbfdWqeWxHG4nTWX1Bcaqw","Util");var a={getWXFriendRanks:function(){return new Promise(function(e,t){wx.getFriendCloudStorage({keyList:["score"],success:function(t){for(var n=[],a=0;a<t.data.length;a++){for(var i=t.data[a],r=null,o=0;o<i.KVDataList.length;o++){var s=i.KVDataList[o];if("score"===s.key){r=JSON.parse(s.value);break}if(r)break}if(r){var c={};c.score=r.score||0,c.startTime=r.startTime||0,c.endTime=r.endTime||0,c.openid=i.openid,c.nickname=i.nickname,c.avatarUrl=i.avatarUrl,n.push(c)}}n.sort(function(e,t){return-(e.score-t.score)}),n.length>0&&e(n)}})})},getWeChatUserInfo:function(){return new Promise(function(e,t){wx.getUserInfo({openIdList:["selfOpenId"],success:function(t){e(t.data)},fail:function(e){t(e)}})})},isAllScreen:function(){var e=cc.view.getFrameSize();return(e.width>e.height?e.width/e.height:e.height/e.width)>1.85}};t.exports=a,cc._RF.pop()},{}]},{},["DataMain","BalancePassedView","FriendPassedView","PhotoPrefab","RankItemPrefab","Util"]);