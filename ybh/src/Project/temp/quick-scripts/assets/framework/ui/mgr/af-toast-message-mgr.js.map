{"version":3,"sources":["af-toast-message-mgr.js"],"names":["EventDispatcher","require","Event","Const","ToastMessage","DEFAULT_MESSAGE_STYLE_PATH","_styles","addStyle","name","prefabPath","cc","loader","loadRes","err","prefab","CC_EDITOR","error","resetDefaultStyle","undefined","show","msg","duration","style","log","_msgQueue","push","text","_hasMsgShowing","_showMessage","length","shift","node","instantiate","setPosition","winSize","width","height","zIndex","TOAST_MESSAGE_Z_ORDER","com","getComponent","self","showMessage","setTimeout","director","getScene","addChild","once","GAME_LOADED","module","exports","window","AF"],"mappings":"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","file":"af-toast-message-mgr.js","sourceRoot":"../../../../../../assets/framework/ui/mgr","sourcesContent":["/**\r\n * 吐司消息管理器\r\n */\r\nvar EventDispatcher = require(\"af-event-dispatcher\");\r\nvar Event = require(\"af-event\");\r\n\r\nvar Const = require(\"af-const\");\r\n\r\nvar ToastMessage = {};\r\n\r\nvar DEFAULT_MESSAGE_STYLE_PATH = 'framework/prefabs/DefaultToastMessageStyle';\r\n\r\nvar _styles = {};\r\n\r\n// 添加样式\r\nToastMessage.addStyle = function(name, prefabPath) {\r\n    cc.loader.loadRes(prefabPath, function (err, prefab) {\r\n        if (err) {\r\n            !CC_EDITOR && cc.error(\"can not default toast message style, error:\", err);\r\n            return;\r\n        }\r\n        _styles[name] = prefab;\r\n    });\r\n};\r\n\r\n// 重置默认样式\r\nToastMessage.resetDefaultStyle = function(prefabPath) {\r\n    _styles['default'] = undefined;\r\n    if (prefabPath) {\r\n        this.addStyle('default', prefabPath);\r\n    }\r\n};\r\n\r\nToastMessage.show = function(msg, duration, style) {\r\n    if (msg) {\r\n        cc.log('Toast->', msg);\r\n        this._msgQueue = this._msgQueue || [];\r\n        this._msgQueue.push({text:msg, duration: duration, style:style});\r\n        !this._hasMsgShowing && this._showMessage();\r\n    }\r\n};\r\n\r\nToastMessage._showMessage = function() { \r\n    if (this._msgQueue.length <= 0) return;\r\n    var msg = this._msgQueue.shift();\r\n\r\n    // 样式\r\n    var prefab;\r\n    if (_styles[msg.style]) {\r\n        prefab = _styles[msg.style];\r\n    } else {\r\n        prefab = _styles['default'] ? _styles['default'] : _styles['_default_'];\r\n    }\r\n    var node = cc.instantiate(prefab);\r\n    node.setPosition(cc.winSize.width/2, cc.winSize.height/2);\r\n    node.zIndex = Const.TOAST_MESSAGE_Z_ORDER;\r\n    var com = node.getComponent(\"AFToastMessage\");\r\n    if (!com) return;\r\n    var self = this;\r\n    this._hasMsgShowing = true;\r\n    com.showMessage(msg.text, msg.duration, function(){\r\n        // self._showMessage();\r\n        // self._hasMsgShowing = false;\r\n    });\r\n    setTimeout(function(){\r\n        self._showMessage();\r\n        self._hasMsgShowing = false;\r\n    }, msg.duration * 1000);\r\n    cc.director.getScene().addChild(node);\r\n};\r\n\r\n// 加载默认的吐司消息样式\r\n// cc.game.once(cc.game.EVENT_GAME_INITED, function () {\r\n//     ToastMessage.addStyle('_default_', DEFAULT_MESSAGE_STYLE_PATH);\r\n// });\r\n// 加载框架默认的吐司消息样式\r\nEventDispatcher.once(Event.GAME_LOADED, function () {\r\n    ToastMessage.addStyle('_default_', DEFAULT_MESSAGE_STYLE_PATH);\r\n});\r\n\r\nmodule.exports =  (window.AF = window.AF || {}).ToastMessage = ToastMessage;"]}