{"version":3,"sources":["AFToastMessage.js"],"names":["cc","Class","extends","Component","editor","menu","properties","msgPanel","default","type","Node","displayName","msgLabel","RichText","defaultDuration","range","onLoad","node","opacity","showMessage","msg","duration","cb","error","string","scheduleOnce","_resizeTextPanel","bind","_showPopoutAnimation","sz","getContentSize","maxWidth","winSize","width","setContentSize","height","offsetY","act","sequence","fadeTo","delayTime","spawn","moveBy","v2","callFunc","zIndex","destroy","runAction"],"mappings":"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","file":"AFToastMessage.js","sourceRoot":"../../../../../../assets/framework/ui/widget","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    editor: {\r\n        menu: 'ApplicationFramework/AFToastMessage'\r\n    },\r\n\r\n    properties: {\r\n        msgPanel: {\r\n            default: null,\r\n            type: cc.Node,\r\n            displayName: \"消息底框\",\r\n        },\r\n        msgLabel: {\r\n            default: null,\r\n            type: cc.RichText,\r\n            displayName: \"消息文本标签\",\r\n        },\r\n\r\n        defaultDuration: {\r\n            default: 3,\r\n            displayName: \"默认持续时间\",\r\n            range: [1, 10]\r\n        },\r\n        \r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this.node.opacity = 255;\r\n    },\r\n\r\n    showMessage: function(msg, duration, cb) {\r\n        if (!this.msgLabel) {\r\n            cc.error(\"not found toast message text label.\");\r\n            return;\r\n        }\r\n        \r\n        this.msgLabel.string = msg || \"\";\r\n        \r\n        this.msgLabel.node.opacity = 0;\r\n        this.scheduleOnce(this._resizeTextPanel.bind(this), 0);\r\n\r\n        this._showPopoutAnimation(duration, cb);\r\n    },\r\n\r\n    _resizeTextPanel: function() {\r\n        if (!this.msgPanel) {\r\n            cc.error(\"not found toast message text panel.\");\r\n            return;\r\n        }\r\n\r\n        var sz = this.msgLabel.node.getContentSize();\r\n\r\n        var maxWidth = cc.winSize.width - 160;\r\n        if (sz.width > maxWidth) {\r\n            this.msgLabel.maxWidth = maxWidth;\r\n            this.scheduleOnce(this._resizeTextPanel.bind(this), 0);\r\n            return;\r\n        }\r\n        this.msgLabel.node.opacity = 255;\r\n        this.msgPanel.setContentSize(sz.width + 40, sz.height + 30);\r\n    },\r\n\r\n    _showPopoutAnimation: function(duration, cb) {\r\n        var node = this.node;\r\n        var offsetY = this.node.height/2 > 100 ? this.node.height/2 + 20 : 100;\r\n        var act = cc.sequence(\r\n            cc.fadeTo(0.1, 255),\r\n            cc.delayTime(duration ? duration : this.defaultDuration),\r\n            cc.spawn(\r\n                cc.moveBy(0.5, cc.v2(0, offsetY)),\r\n                cc.fadeTo(0.5, 0.1),\r\n                cc.sequence(\r\n                    cc.delayTime(0.45),\r\n                    cc.callFunc(function(){\r\n                        cb && cb();\r\n                        node.zIndex -= 1;\r\n                    })\r\n                )\r\n            ),\r\n            cc.callFunc(function(){\r\n                node.destroy();\r\n            })\r\n        );\r\n        node.runAction(act);\r\n    },\r\n});"]}