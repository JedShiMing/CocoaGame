{"version":3,"sources":["AFPlayEffect.js"],"names":["AFPlayEffect","cc","Class","extends","Component","editor","menu","properties","onLoad","anim","getComponent","Animation","hide","show","clipName","cb","node","active","_hiding","unschedule","_hide","clip","defaultClip","name","play","targetOff","on","undefined","_onAnimFinished","setCurrentTime","sample","stop","scheduleOnce","gotoTime","time","gotoLastFrame","currentClip","clips","getClips","i","length","duration"],"mappings":"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","file":"AFPlayEffect.js","sourceRoot":"../../../../../../assets/framework/ui/component","sourcesContent":["var AFPlayEffect = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    editor: {\r\n        menu: 'ApplicationFramework/AFPlayEffect'\r\n    },\r\n\r\n    properties: {\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this.anim = this.getComponent(cc.Animation);\r\n\r\n        this.hide();\r\n    },\r\n\r\n    show: function(clipName, cb) {\r\n        this.node.active = true;\r\n\r\n        if(this._hiding) {\r\n            this.unschedule(this._hide);\r\n            this._hiding = false;\r\n        }\r\n\r\n        var clip = clipName || this.anim.defaultClip.name;\r\n        this.anim.play(clip);\r\n        \r\n        if (cb) {\r\n            this.anim.targetOff(this);\r\n            this.anim.on('finished',  function(){\r\n                cb && cb();\r\n                cb = undefined;\r\n            }, this);\r\n        }\r\n    },\r\n\r\n    _onAnimFinished: function () {\r\n\r\n    },\r\n\r\n    hide: function(clipName) {\r\n        if(this.node.active) {\r\n            var clip = clipName || this.anim.defaultClip.name;\r\n\r\n            this.anim.play(clip);\r\n            this.anim.setCurrentTime(0);\r\n            this.anim.sample();\r\n            this.anim.stop();\r\n            if (!this._hiding) {\r\n                this._hiding = true;\r\n                this.scheduleOnce(this._hide, 0);\r\n            }\r\n        }\r\n    },\r\n\r\n    gotoTime: function (time, clipName) {\r\n        this.anim.play(clipName);\r\n        this.anim.setCurrentTime(time, clipName);\r\n        this.anim.sample();\r\n        this.anim.stop();\r\n    },\r\n\r\n    gotoLastFrame: function (clipName) {\r\n        var clip;\r\n        if (clipName === undefined) {\r\n            clip = this.anim.currentClip  || this.anim.defaultClip;\r\n        } else {\r\n            var clips = this.anim.getClips();\r\n            for (var i = 0; i < clips.length; ++i) {\r\n                if (clips[i].name == clipName) {\r\n                    clip = clips[i];\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (!clip) return;\r\n        this.anim.play(clip.name);\r\n        this.anim.setCurrentTime(clip.duration, clip.name);\r\n        this.anim.sample();\r\n        this.anim.stop();\r\n    },\r\n\r\n    _hide: function() {\r\n        this.node.active = false;\r\n        this._hiding = false;\r\n    }\r\n});"]}