{"version":3,"sources":["af-platform.js"],"names":["serverKey","require","serverVer","serverUrl","platform","init","WX_GAME_ENV","WX_GAME_DEVTOOLS","QQ_GAME_ENV","wx","info","getSystemInfoSync","BK","isStart","start","isVideoAdOpen","AF","isWxApp","isWxPhone","wxHelper","isQQApp","qqHelper","getSrc","getServerUrl","src","getSystemInfo","windowWidth","windowHeight","data","getServerKey","key","getQueryValue","urls","getUrls","getCdnUrl","cdn","getApiUrl","api","getDisplayVersion","num","version","hotfix","str","displayVersion","getLaunchOptionsSync","query","util","GetRequest","isHairScreen","cc","winSize","height","width","setKeepScreenOn","keepScreenOn","console","log","request","obj","method","http","post","url","err","result","status","success","statusCode","fail","get","module","exports","window"],"mappings":"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","file":"af-platform.js","sourceRoot":"../../../../../assets/framework/utils","sourcesContent":["/**\r\n * 设备平台相关的\r\n */\r\n\r\nvar serverKey = require('../config/serverKey.js')\r\nvar serverVer = require('../config/serverVer.js')\r\nvar serverUrl = require('../config/serverUrl.js')\r\n\r\nvar platform = {\r\n    init: function () {\r\n        this.WX_GAME_ENV = false;       //微信平台\r\n        this.WX_GAME_DEVTOOLS = false;  //微信模拟器\r\n        this.QQ_GAME_ENV = false;       //QQ平台\r\n\r\n        if ('undefined' !== typeof (wx)) {\r\n            this.WX_GAME_ENV = true;\r\n\r\n            var info =  wx.getSystemInfoSync();\r\n\r\n            if (info.platform == \"devtools\") {\r\n                this.WX_GAME_DEVTOOLS = true;\r\n            }\r\n        } else if ('undefined' !== typeof (BK)) {\r\n            this.QQ_GAME_ENV = true;\r\n        }\r\n\r\n        this.isStart = false;\r\n    },\r\n\r\n    start: function (isVideoAdOpen) {\r\n        if (AF.platform.isStart) {\r\n            return;\r\n        }\r\n\r\n        AF.platform.isStart = true;\r\n\r\n        if (AF.platform.isWxApp()) {\r\n            var isWxPhone = AF.platform.isWxPhone();\r\n            AF.wxHelper.init(isWxPhone, isVideoAdOpen);\r\n        } else if (AF.platform.isQQApp()) {\r\n            AF.qqHelper.init(isVideoAdOpen);\r\n        }\r\n    },\r\n\r\n    getSrc: function () {\r\n        return AF.platform.getServerUrl().src;\r\n    },\r\n\r\n    isWxApp: function () {\r\n        return AF.platform.WX_GAME_ENV;\r\n    },\r\n\r\n    isQQApp: function () {\r\n        return AF.platform.QQ_GAME_ENV;\r\n    },\r\n\r\n    isWxPhone: function () {\r\n        if (AF.platform.WX_GAME_ENV && !AF.platform.WX_GAME_DEVTOOLS) {\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    },\r\n\r\n    getSystemInfo: function () {\r\n        var info = {};\r\n\r\n        info.windowWidth = 0;\r\n        info.windowHeight = 0;\r\n\r\n        if (AF.platform.isWxApp()) {\r\n            var data = wx.getSystemInfoSync();\r\n            info.windowWidth = data.windowWidth;\r\n            info.windowHeight = data.windowHeight;\r\n        }\r\n\r\n        return info;\r\n    },\r\n\r\n    getServerKey: function () {\r\n        var key =  AF.platform.getQueryValue(\"server\") || serverKey;\r\n        var urls = serverUrl.getUrls();\r\n\r\n        if (key == \"\") {\r\n            key = \"test\";\r\n        }\r\n\r\n        if (!urls[key]) {\r\n            key = \"test\";\r\n        }\r\n\r\n        // console.log(\"serverKey\", key);\r\n\r\n        return key;\r\n    },\r\n\r\n    getServerUrl: function () {\r\n        var urls = serverUrl.getUrls();\r\n\r\n        return urls[AF.platform.getServerKey()];\r\n    },\r\n\r\n    getCdnUrl: function () {\r\n        return AF.platform.getServerUrl().cdn;\r\n    },\r\n\r\n    getApiUrl: function () {\r\n        return AF.platform.getServerUrl().api;\r\n    },\r\n\r\n    getDisplayVersion: function () {\r\n        var num = serverVer.version * 100 + serverVer.hotfix;\r\n        var str = serverVer.displayVersion + \" (\" + num + \")\";\r\n        return str;\r\n    },\r\n\r\n    getQueryValue: function (key) {\r\n        if (AF.platform.isWxApp()) {\r\n            return wx.getLaunchOptionsSync().query[key] || \"\";\r\n        } else {\r\n            var query = AF.util.GetRequest();\r\n            return query[key] || \"\";\r\n        }\r\n    },\r\n\r\n    isHairScreen: function () {\r\n        if (cc.winSize.height / cc.winSize.width >= 2) {\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    },\r\n\r\n    setKeepScreenOn: function () {\r\n        if (AF.platform.isWxPhone()) {\r\n            wx.setKeepScreenOn({ keepScreenOn: true });\r\n            console.log(\"wx设置屏幕常亮\");\r\n        }\r\n    },\r\n\r\n    request: function (obj) {\r\n        if (obj.method && obj.method === \"POST\") {\r\n            AF.http.post(obj.url, null, obj.data, (err, result, status) => {\r\n                if (status) {\r\n                    obj.success && obj.success({ data: result, statusCode: status });\r\n                } else {\r\n                    obj.fail && obj.fail({ data: result, statusCode: status });\r\n                }\r\n            });\r\n        } else {\r\n            AF.http.get(obj.url, obj.data, (err, result, status) => {\r\n                if (status) {\r\n                    obj.success && obj.success({ data: result, statusCode: status });\r\n                } else {\r\n                    obj.fail && obj.fail({ data: result, statusCode: status });\r\n                }\r\n            });\r\n        }\r\n    },\r\n};\r\n\r\nplatform.init();\r\n\r\nmodule.exports = (window.AF = window.AF || {}).platform = platform;"]}