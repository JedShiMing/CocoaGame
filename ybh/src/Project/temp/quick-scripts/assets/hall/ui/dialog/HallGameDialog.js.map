{"version":3,"sources":["HallGameDialog.js"],"names":["DialogBase","require","itemWidth","cc","Class","extends","properties","title","Label","itemWrap","Node","linkWrap","prefabItem","Prefab","prefabLink","label_gold","top","bottom","onLoad","prototype","call","AF","EventDispatcher","on","refreshGold","info","items","selectedItems","tipCount","onEnable","playerData","GameData","getMyPlayerData","params","DIALOG_PARAMS","pointId","initUI","GameConfig","getPointInfo","initItemNodes","EventType","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","emit","onDisable","off","onDestroy","string","gold","toString","onBackButtonClick","event","custom","gotoScene","update","dt","willShowTips","length","now","Date","lastUpdate","item","shift","updateTipLink","destroyAllChildren","startTime","passed","active","x","w","y","h","node","instantiate","name","parent","linkNode","gameitem","getComponent","GameItem","position","linkitem","LinkItem","width","height","path","forEach","index","setZero","setSelected","setActive","Widget","updateAlignment","e","currentItem","calcPos","foundIdx","i","animateScale","updateSelectLink","splice","getActive","lastSelectItem","pos","getRelativePos","test","pop","getSelected","push","checkPass","parentPos","convertToWorldSpaceAR","v2","getLocationX","getLocationY","xidx","Math","floor","yidx","ceil","lastitem","x0","y0","x1","y1","costTime","over","util","upScore","score","endTime","setMyPlayerData","savePlayerData","scheduleOnce","openDialog","close","next","bind","clearSelected","checkShowGameTip","showGameTip","showVideoAd","suc","slice","start","lastPath","currPath","nextPath","currItem"],"mappings":"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","file":"HallGameDialog.js","sourceRoot":"../../../../../../assets/hall/ui/dialog","sourcesContent":["import GameItem from './GameItem'\nimport LinkItem from './LinkItem'\n\nvar DialogBase = require('AFDialogBase');\nconst itemWidth = 90\n\ncc.Class({\n    extends: DialogBase,\n\n    properties: {\n        title: cc.Label,\n        itemWrap: cc.Node,\n        linkWrap: cc.Node,\n        prefabItem: cc.Prefab,\n        prefabLink: cc.Prefab,\n        label_gold: cc.Label,\n\n        top:cc.Node,\n        bottom: cc.Node,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad: function () {\n        DialogBase.prototype.onLoad.call(this);\n\n        AF.EventDispatcher.on('GoldRefresh', this.refreshGold,this);\n        this.info = null\n        this.items = []\n        this.selectedItems = []\n        this.tipCount = 1\n    },\n\n    onEnable: function () {\n        DialogBase.prototype.onEnable.call(this);\n\n        this.playerData = AF.GameData.getMyPlayerData();\n\n        var params = AF.DIALOG_PARAMS();\n        this.pointId = params.pointId || 1;\n\n        this.initUI();\n\n        this.info = AF.GameConfig.getPointInfo(this.pointId);\n\n        this.initItemNodes()\n        this.itemWrap.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\n        this.itemWrap.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n\n        AF.EventDispatcher.emit('ShowFriendPassed', this.pointId);\n\n    },\n\n    onDisable: function () {\n        DialogBase.prototype.onDisable.call(this);\n\n        AF.EventDispatcher.emit('HideFriendPassed');\n\n        this.itemWrap.off(cc.Node.EventType.TOUCH_START, this.onTouchStart)\n        this.itemWrap.off(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n    },\n    onDestroy(){\n        DialogBase.prototype.onDestroy.call(this);\n        AF.EventDispatcher.off('GoldRefresh', this.refreshGold, this);\n    },\n\n    refreshGold(){\n        this.playerData = AF.GameData.getMyPlayerData();\n        this.label_gold.string = this.playerData.gold.toString()\n    },\n\n    initUI: function () {\n        //适配iPhoneX，bg沉到最底下\n        //this.bg.y = (this.bg.height - cc.winSize.height)/2;\n        // this.bg.y = (0 - cc.winSize.height) / 2;\n        this.title.string = this.pointId.toString()\n    },\n\n    onBackButtonClick: function (event, custom) {\n        AF.gotoScene(\"HallMainScene\");\n    },\n\n    update: function (dt) {\n        if (!this.willShowTips || this.willShowTips.length <= 0) {\n            return\n        }\n        const now = Date.now()\n        if (!this.lastUpdate || now - this.lastUpdate >= 100) {\n            const item = this.willShowTips.shift()\n            if (item[0]) {\n                item[0].updateTipLink(item[1], item[2])\n            }\n            if (this.willShowTips.length <= 0) {\n                this.willShowTips = null\n            }\n            this.lastUpdate = now\n        }\n    },\n\n\n    initItemNodes: function () {\n        this.itemWrap.destroyAllChildren()\n        this.linkWrap.destroyAllChildren()\n        this.items = []\n        this.selectedItems = []\n        this.tipCount = 1\n        this.startTime = Date.now()\n        this.passed = false\n        this.willShowTips = null\n        //上 下node显示\n        // this.top.active = true\n        this.bottom.active = true\n        \n        this.label_gold.string = this.playerData.gold.toString()\n\n        for (let x = 0; x < this.info.w; x++) {\n            this.items[x] = []\n            for (let y = 0; y < this.info.h; y++) {\n                let node = cc.instantiate(this.prefabItem)\n                node.x = x * itemWidth + 45;\n                node.y = (this.info.h - 1 - y) * itemWidth + 45;\n                node.name = `item_${x}_${y}`\n                node.parent = this.itemWrap\n\n                let linkNode = cc.instantiate(this.prefabLink)\n                linkNode.x = x * itemWidth;\n                linkNode.y = (this.info.h - 1 - y) * itemWidth;\n                linkNode.parent = this.linkWrap\n\n                this.items[x][y] = {\n                    node,\n                    gameitem: node.getComponent(GameItem),\n                    position: [x, y],\n                    linkNode,\n                    linkitem: linkNode.getComponent(LinkItem),\n                }\n            }\n        }\n        this.itemWrap.width = this.info.w * itemWidth\n        this.itemWrap.height = this.info.h * itemWidth\n        this.linkWrap.width = this.info.w * itemWidth\n        this.linkWrap.height = this.info.h * itemWidth\n\n        // let lastitem = null\n        this.info.path.forEach(([x, y], index) => {\n            if (index === 0) {\n                this.items[x][y].gameitem.setZero(true)\n                this.items[x][y].gameitem.setSelected(true)\n                this.selectedItems = [this.items[x][y]]\n            }\n            this.items[x][y].gameitem.setActive(true)\n            // this.items[x][y].gameitem.setLabel(`${index}`)\n        });\n\n        this.itemWrap.getComponent(cc.Widget).updateAlignment()\n        this.linkWrap.getComponent(cc.Widget).updateAlignment()\n    },\n\n    onTouchStart: function (e) {\n        const currentItem = this.calcPos(e)\n        if (!currentItem) {\n            return\n        }\n        //回退\n        let foundIdx = -1\n        for (let i = 0; i < this.selectedItems.length; i++) {\n            if (this.selectedItems[i] === currentItem) {\n                foundIdx = i\n                currentItem.gameitem.animateScale()\n            }\n            if (foundIdx !== -1 && i > foundIdx) {\n                this.selectedItems[i].gameitem.setSelected(false)\n                this.selectedItems[i].linkitem.updateSelectLink('', false)\n            }\n        }\n        if (foundIdx !== -1) {\n            this.selectedItems.splice(foundIdx + 1)\n        }\n    },\n\n    onTouchMove: function (e) {\n        if (this.passed) {\n            return\n        }\n        const currentItem = this.calcPos(e)\n        if (!currentItem || !currentItem.gameitem.getActive()) {\n            return\n        }\n        let lastSelectItem = this.selectedItems[this.selectedItems.length - 1]\n        if (currentItem === lastSelectItem) {\n            return\n        }\n        const pos = this.getRelativePos(lastSelectItem.position, currentItem.position)\n        if (!/top|bottom|left|right/.test(pos)) {\n            return\n        }\n        //move过程中只能一格一格回退\n        if (this.selectedItems.length >= 2 && currentItem === this.selectedItems[this.selectedItems.length - 2]) {\n            lastSelectItem.gameitem.setSelected(false)\n            lastSelectItem.linkitem.updateSelectLink('', false)\n            currentItem.gameitem.animateScale()\n            this.selectedItems.pop()\n        } else if (!currentItem.gameitem.getSelected()) {\n            currentItem.gameitem.setSelected(true)\n            currentItem.linkitem.updateSelectLink(pos, true)\n            this.selectedItems.push(currentItem)\n\n            this.checkPass()\n        }\n    },\n\n    calcPos: function (e) {\n        const parentPos = this.itemWrap.convertToWorldSpaceAR(cc.v2(0, 0))\n        const v2 = [e.getLocationX() - parentPos.x, e.getLocationY() - parentPos.y]\n        const xidx = Math.floor(v2[0] / itemWidth)\n        const yidx = this.info.h - Math.ceil(v2[1] / itemWidth)\n\n        if (xidx < 0 || xidx >= this.info.w ||\n            yidx < 0 || yidx >= this.info.h) {\n            return null\n        }\n        return this.items[xidx][yidx]\n    },\n\n    getRelativePos: function (lastitem, item) {\n        if (!lastitem || !item) return ''\n        const [x0, y0] = lastitem\n        const [x1, y1] = item\n        if (x0 === x1) {\n            if (y0 - y1 === 1) return 'bottom'\n            else if (y0 - y1 === -1) return 'top'\n        } else if (y0 === y1) {\n            if (x0 - x1 === 1) return 'right'\n            else if (x0 - x1 === -1) return 'left'\n        }\n        return ''\n    },\n\n    checkPass: function () {\n        if (this.selectedItems.length < this.info.path.length) {\n            return false\n        }\n        // AF.ToastMessage.show(\"过关\");\n        const costTime = Date.now() - this.startTime\n        this.passed = true\n        let over = false\n        if(this.playerData.pointId < this.pointId){\n            //上传分数\n            AF.util.upScore({\n                score: this.pointId,\n                startTime: this.startTime,\n                endTime: Date.now(),\n            })\n            this.playerData.pointId = this.pointId\n            over = true\n            AF.GameData.setMyPlayerData(this.playerData);\n            AF.GameData.savePlayerData(this.playerData);\n        }\n        \n        \n        // this.top.active = false\n        this.scheduleOnce(()=>{\n            this.bottom.active = false\n            AF.EventDispatcher.emit('HideFriendPassed');\n\n            AF.openDialog(\"HallBalanceDialog\", { costTime,\n                over,\n                pointId: this.pointId,\n                close: ()=>AF.gotoScene(\"HallMainScene\"),\n                next: this.next.bind(this) });\n        }, 0.5)\n        return true\n    },\n\n    clearSelected: function () {\n        this.selectedItems.forEach((item, index) => {\n            if (index !== 0) {\n                item.gameitem.setSelected(false)\n                item.linkitem.updateSelectLink('', false)\n            }\n        })\n        this.selectedItems.splice(1)\n    },\n\n    checkShowGameTip: function (e) {\n        if (this.tipCount >= this.info.path.length || this.willShowTips) {\n            return\n        }\n        if(this.playerData.gold >= 200){\n            this.playerData.gold -= 200\n            this.label_gold.string = this.playerData.gold.toString()\n            AF.GameData.setMyPlayerData(this.playerData);\n            AF.GameData.savePlayerData(this.playerData);\n            this.showGameTip()\n        }else{\n            AF.util.showVideoAd('battle', (suc)=>{\n                if(suc){\n                    this.showGameTip()\n                }\n            })\n        }\n        \n    },\n\n    showGameTip(){\n        this.clearSelected()\n        this.tipCount += 5\n        // const minTimer = () => new Promise((resolve) => setTimeout(resolve, 100))\n        const items = this.info.path.slice(0, this.tipCount)\n        let start = this.tipCount - 6\n        start = start < 1 ? 1 : start\n        this.willShowTips = []\n        for (let i = start; i < items.length; i++) {\n            let lastPath = items[i - 1]\n            let currPath = items[i]\n            let nextPath = items[i + 1] || null\n\n            let currItem = this.items[currPath[0]][currPath[1]]\n            this.willShowTips.push([currItem.linkitem, this.getRelativePos(lastPath, currPath), this.getRelativePos(nextPath, currPath)])\n        }\n    },\n\n    next: function () {\n        this.pointId = this.pointId + 1;\n        this.initUI()\n        this.info = AF.GameConfig.getPointInfo(this.pointId);\n\n        AF.EventDispatcher.emit('ShowFriendPassed', this.pointId);\n\n        this.initItemNodes()\n    },\n})\n\n\n\n"]}