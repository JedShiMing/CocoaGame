{"version":3,"sources":["HallRankScene.js"],"names":["RANK_ITEM_HEIGHT","RANK_ITEM_PADDING","cc","Class","extends","Component","properties","bg","Node","scrollView","ScrollView","RankItemPre","Prefab","scrView","display","onLoad","self","AF","platform","isWxApp","node","active","isQQApp","util","getRankList","data","length","setPlayerData","EventDispatcher","emit","Event","SCENE_LOADED","on","onTouchMove","onEnable","start","isAllScreen","disWid","getComponent","Widget","console","log","top","updateAlignment","postMessage","height","winSize","event","moveY","getScrollOffset","y","selfItem","startY","players","friends","total_height","myPlayer","myRank","i","item","instantiate","content","addChild","setPlayerInfo","url","nick","score","x","width","selfFlag","onBackButtonClick","custom","gotoScene"],"mappings":"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","file":"HallRankScene.js","sourceRoot":"../../../../../../assets/hall/ui/scene","sourcesContent":["const RANK_ITEM_HEIGHT = 108;\nconst RANK_ITEM_PADDING = 14;\n// const list = [\n//     {\n//         url: '',\n//         score: 100,\n//         nick: 'jed',\n//         selfFlag: false\n//     },{\n//         url: '',\n//         score: 100,\n//         nick: 'jed2',\n//         selfFlag: false\n//     },{\n//         url: '',\n//         score: 100,\n//         nick: 'jed2',\n//         selfFlag: false\n//     },{\n//         url: '',\n//         score: 100,\n//         nick: 'jed2',\n//         selfFlag: false\n//     },{\n//         url: '',\n//         score: 100,\n//         nick: 'jed2',\n//         selfFlag: false\n//     },{\n//         url: '',\n//         score: 100,\n//         nick: 'jed2',\n//         selfFlag: false\n//     },{\n//         url: '',\n//         score: 100,\n//         nick: 'jed2',\n//         selfFlag: false\n//     },{\n//         url: '',\n//         score: 100,\n//         nick: 'jed2',\n//         selfFlag: false\n//     },{\n//         url: '',\n//         score: 100,\n//         nick: 'jed2',\n//         selfFlag: false\n//     },{\n//         url: '',\n//         score: 100,\n//         nick: 'jed2',\n//         selfFlag: false\n//     },{\n//         url: '',\n//         score: 100,\n//         nick: 'jed2',\n//         selfFlag: false\n//     },{\n//         url: '',\n//         score: 100,\n//         nick: 'jed2',\n//         selfFlag: false\n//     }\n//     ]\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        bg: cc.Node,\n        scrollView: cc.ScrollView,\n        RankItemPre: cc.Prefab,\n        scrView: cc.Node,\n        display: cc.Node,\n    },\n\n    onLoad: function () {\n        let self = this;\n        if (AF.platform.isWxApp()) {\n            self.scrollView.node.active = false\n        } else if (AF.platform.isQQApp()) {\n            AF.util.getRankList((data) => {\n                if (data && data.length > 0) {\n                    self.setPlayerData(data)\n                }\n            });\n            // self.setPlayerData(list)\n            self.scrollView.node.active = true;\n            AF.EventDispatcher.emit(AF.Event.SCENE_LOADED);\n            self.scrollView.node.on('scrolling', this.onTouchMove, this, true)\n        } else {\n            AF.util.getRankList((data) => {\n                if (data && data.length > 0) {\n                    self.setPlayerData(data)\n                }\n            })\n        }\n    },\n\n    onEnable: function () {\n        AF.EventDispatcher.emit(AF.Event.SCENE_LOADED);\n    },\n\n    start() {\n        let self = this\n        if (AF.platform.isWxApp()) {\n            if (AF.util.isAllScreen()) {\n                let disWid = self.display.getComponent(cc.Widget)\n                console.log('disWid = ', disWid)\n                disWid.top = 190\n                disWid.updateAlignment()\n            }\n            AF.util.postMessage(2, {isAllScreen: AF.util.isAllScreen(), height: cc.winSize.height});\n        }\n    },\n\n    onTouchMove: function (event) {\n        let self = this\n        let moveY = self.scrollView.getComponent(cc.ScrollView).getScrollOffset().y;\n        self.selfItem.active = !((moveY >= self.startY - self.scrView.height) && (moveY <= self.startY + RANK_ITEM_HEIGHT));\n    },\n\n    setPlayerData: function (players) {\n        let self = this;\n        let friends = players;\n        let total_height = friends.length * RANK_ITEM_HEIGHT + RANK_ITEM_PADDING * (friends.length - 1);\n\n        if (total_height < self.scrollView.node.height) {\n            total_height = self.scrollView.node.height;\n        }\n        let myPlayer = null;\n        let myRank;\n\n        for (let i = 0; i < friends.length; i++) {\n            let item = cc.instantiate(self.RankItemPre);\n            self.scrollView.content.addChild(item);\n\n            item.getComponent(\"RankItemPrefab\").setPlayerInfo(i + 1, friends[i].url, friends[i].nick, friends[i].score, false);\n\n            item.x = self.scrollView.content.width / 2;\n\n            if (friends[i].selfFlag) {\n                self.startY = i * (RANK_ITEM_PADDING + RANK_ITEM_HEIGHT)\n                myPlayer = friends[i];\n                myRank = i + 1;\n            }\n        }\n\n        if (myPlayer) {\n            self.selfItem = cc.instantiate(self.RankItemPre);\n            self.bg.addChild(self.selfItem);\n\n            self.selfItem.getComponent(\"RankItemPrefab\").setPlayerInfo(myRank, myPlayer.url, myPlayer.nick, myPlayer.score, true);\n            self.selfItem.x = 0;\n            self.selfItem.y = -(self.scrollView.node.height / 2);\n            self.selfItem.active = self.scrView.height < self.startY\n        }\n    },\n\n    onBackButtonClick: function (event, custom) {\n        console.log('返回了上一页')\n        AF.gotoScene(\"HallMainScene\");\n    },\n});\n"]}