{"version":3,"sources":["EffectPrefab.js"],"names":["EFFECT_TYPE","COUNT","TIME","MAP","CUSTOM","cc","Class","extends","Component","properties","aniNode","Node","onLoad","aniName","listenFilename","moveInfo","rate","delayTime","sp","getComponent","Sprite","ani","Animation","on","onFinished","isLoaded","working","effectKey","AF","EventDispatcher","Event","FILE_LOADFRAME","onLoadFrameEnded","isStart","doStart","name","type","params","stopState","error","node","console","warn","parent","active","act","sequence","callFunc","tryPlayEffect","Frameloader","startLoadFile","runAction","setNodeName","checkAnimationExist","doMoveAction","rotation","playAniByName","setMapEffect","clips","getClips","i","length","clip","play","addAnimation","stopAniByName","stop","setFlipX","flipX","scaleX","Math","abs","setEffectKey","checkLoaded","checkWorking","event","Infinity","self","floor","random","frames","succ","createAni","spriteFrame","width","height","AnimationClip","createWithSpriteFrames","wrapMode","WrapMode","Normal","sample","speed","addClip","mt","dt","pSub","position","dest","radian","atan2","x","y","dir","PI","speedType","moveTo","easing","easeSineIn","easeSineOut","onDestroy","off","update"],"mappings":"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","file":"EffectPrefab.js","sourceRoot":"../../../../../../assets/hall/ui/widget","sourcesContent":["const EFFECT_TYPE = {\r\n    COUNT: 1,//计次\r\n    TIME: 2,//计时\r\n    MAP: 3,//地图\r\n    CUSTOM: 4//自定义\r\n};\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        aniNode: cc.Node,\r\n    },\r\n\r\n    onLoad: function () {\r\n        this.aniName = \"\";\r\n        this.listenFilename = \"\";\r\n        this.moveInfo = null;\r\n        this.rate = 10;\r\n        this.delayTime = 0;\r\n        this.sp = this.aniNode.getComponent(cc.Sprite);\r\n        this.ani = this.aniNode.getComponent(cc.Animation);\r\n        this.ani.on('finished', this.onFinished, this);\r\n        this.isLoaded = false;\r\n        this.working = false;\r\n        this.effectKey = \"\";\r\n        AF.EventDispatcher.on(AF.Event.FILE_LOADFRAME, this.onLoadFrameEnded, this);\r\n\r\n        this.isStart = false;\r\n    },\r\n\r\n    // 该特效接口 自动播放\r\n    // name 特效名\r\n    // type 1计次 2计时 3 地图特效 4 自定义特效\r\n    // params 0=> repeatCount 1=> playTime  重复次数和播放时间\r\n    // rate 帧数/s\r\n    // moveInfo null || {dest,speedType} 移动信息 {目标点,速度类型0匀速 1加速 2减速 }\r\n    // delaytime 延迟时间\r\n    doStart: function (name, type, params, rate, moveInfo, delayTime) {\r\n        this.stopState = false;\r\n\r\n        if (!name) {\r\n            cc.error('特效预制件doStart参数name错误', name);\r\n            // this.node.destroy();\r\n            return;\r\n        }\r\n        // console.log(\"特效 创建\", name);\r\n\r\n        if (!this.node) {\r\n            console.warn('该节点已经被销毁');\r\n            return;\r\n        }\r\n\r\n        if (!this.node.parent) {\r\n            console.warn('该节点的父节点已经被销毁');\r\n            return;\r\n        }\r\n\r\n        this.isLoaded = false;\r\n\r\n        this.node.active = true;\r\n        this.aniNode.active = false;\r\n\r\n        this.working = true;\r\n\r\n        this.node.name = name;\r\n        this.type = type;\r\n        this.params = params;\r\n        this.rate = rate || 10;\r\n        this.moveInfo = moveInfo;\r\n        this.delayTime = delayTime || 0;\r\n\r\n        if (this.delayTime) {\r\n            var act = cc.sequence(\r\n                cc.delayTime(delayTime),\r\n                cc.callFunc(function () {\r\n                    this.isStart = true;\r\n                    this.isLoaded = this.tryPlayEffect(name);\r\n                    if (!this.isLoaded) {\r\n                        this.listenFilename = name;\r\n                        AF.Frameloader.startLoadFile(this.listenFilename, 1);\r\n                    }\r\n                }, this)\r\n            );\r\n            this.node.runAction(act);\r\n        } else {\r\n            this.isStart = true;\r\n            this.isLoaded = this.tryPlayEffect(name);\r\n            if (!this.isLoaded) {\r\n                this.listenFilename = name;\r\n                AF.Frameloader.startLoadFile(this.listenFilename, 1);\r\n            }\r\n        }\r\n    },\r\n\r\n    setNodeName: function (name) {\r\n        if(this.node){\r\n            this.node.name = name;\r\n        }\r\n    },\r\n\r\n    tryPlayEffect: function (name) {\r\n        if (!this.checkAnimationExist(name)) {\r\n            return false;\r\n        }\r\n        if (this.moveInfo) {\r\n            this.doMoveAction();\r\n        } else {\r\n            this.node.rotation = 0;\r\n        }\r\n        this.aniName = name;\r\n        return this.playAniByName(this.aniName);\r\n    },\r\n\r\n    setMapEffect: function (name) {\r\n        if (this.aniName === name) {\r\n            return;\r\n        }\r\n        this.aniName = \"\";\r\n        var clips = this.ani.getClips();\r\n        for (let i = 0; i < clips.length; i++) {\r\n            let clip = clips[i];\r\n            if (name === clip.name) {\r\n                this.aniName = name;\r\n                break;\r\n            }\r\n        }\r\n        if (this.aniName) {\r\n            this.ani.play(this.aniName);\r\n            return;\r\n        }\r\n        this.rate = 10;\r\n        this.type = EFFECT_TYPE.MAP;\r\n        this.listenFilename = name;\r\n\r\n        AF.Frameloader.startLoadFile(this.listenFilename, 1);\r\n    },\r\n\r\n    checkAnimationExist: function (name) {\r\n        if (!this.ani) {\r\n            return false;\r\n        }\r\n        var clips = this.ani.getClips();\r\n        for (let i = 0; i < clips.length; i++) {\r\n            let clip = clips[i];\r\n            if (name === clip.name) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    },\r\n\r\n    addAnimation: function (name, type, params, rate) {\r\n\r\n        if (this.playAniByName(name)) {\r\n            return;\r\n        }\r\n        this.rate = rate || 10;\r\n        this.type = type;\r\n        this.params = params;\r\n        this.listenFilename = name;\r\n        AF.Frameloader.startLoadFile(this.listenFilename, 1);\r\n    },\r\n\r\n    playAniByName(name) {\r\n        if (!this.checkAnimationExist(name)) {\r\n            return false;\r\n        }\r\n        // console.log('正在播放', name);\r\n        this.aniNode.active = true;\r\n        this.node.active = true;\r\n        this.ani.play(name);\r\n        return true;\r\n    },\r\n\r\n    stopAniByName(name) {\r\n        this.stopState = true;\r\n        this.aniNode.active = false;\r\n        this.node.active = false;\r\n\r\n        if (!this.checkAnimationExist(name)) {\r\n            return false;\r\n        }\r\n        this.ani.stop(name);\r\n        return true;\r\n    },\r\n\r\n    setFlipX: function (flipX) {\r\n        if (flipX) {\r\n            this.aniNode.scaleX = Math.abs(this.aniNode.scaleX) * -1;\r\n        } else {\r\n            this.aniNode.scaleX = Math.abs(this.aniNode.scaleX);\r\n        }\r\n    },\r\n\r\n    setEffectKey: function (effectKey) {\r\n        this.effectKey = effectKey;\r\n    },\r\n\r\n    checkLoaded: function () {\r\n        return this.isLoaded;\r\n    },\r\n\r\n    checkWorking: function () {\r\n        return this.working;\r\n    },\r\n\r\n    onFinished: function (event) {\r\n        if (EFFECT_TYPE.COUNT === this.type) {\r\n\r\n            if (this.params > 0 && this.params != Infinity) {\r\n                this.params--;\r\n            }\r\n\r\n            if (this.params > 0 || this.params == Infinity) {\r\n                this.ani.play(this.aniName);\r\n            }\r\n            return;\r\n        }\r\n        if (EFFECT_TYPE.TIME === this.type) {\r\n            this.ani.play(this.aniName);\r\n            return;\r\n        }\r\n        if (EFFECT_TYPE.MAP === this.type) {\r\n            var self = this;\r\n            if (!self.aniName) {\r\n                return;\r\n            }\r\n            var delayTime = 1 + Math.floor(Math.random() * 5);\r\n            self.node.runAction(\r\n                cc.sequence(\r\n                    cc.delayTime(delayTime),\r\n                    cc.callFunc(function () {\r\n                        self.ani.play(self.aniName);\r\n                    })\r\n                )\r\n            );\r\n            return;\r\n        }\r\n    },\r\n\r\n    onLoadFrameEnded: function (name, frames, succ) {\r\n        if (this.listenFilename !== \"\" && this.listenFilename === name) {\r\n            if (!succ) {\r\n                console.warn('特效预帧动画' + name + '加载失败');\r\n                // this.node.destroy();\r\n                return;\r\n            }\r\n        } else {\r\n            return;\r\n        }\r\n        this.listenFilename = \"\";\r\n        if (frames[0].length <= 0) {\r\n            console.warn('特效预帧动画' + name + '加载失败');\r\n            // this.node.destroy();\r\n            return;\r\n        }\r\n        // console.log('特效加载成功', name);\r\n        this.createAni(name, frames);\r\n\r\n        this.isLoaded = true;\r\n        if (this.stopState) {\r\n            this.aniNode.active = false;\r\n            this.node.active = false;\r\n            return;\r\n        }\r\n\r\n        if (this.moveInfo) {\r\n            this.doMoveAction();\r\n        } else {\r\n            this.node.rotation = 0;\r\n        }\r\n        this.playAniByName(this.aniName);\r\n    },\r\n\r\n    createAni: function (name, frames) {\r\n        this.aniName = name;\r\n        this.sp.spriteFrame = frames[0][0];\r\n        this.node.width = this.aniNode.width;\r\n        this.node.height = this.aniNode.height;\r\n        var clip = cc.AnimationClip.createWithSpriteFrames(frames[0], this.rate);\r\n\r\n        clip.name = name;\r\n        clip.wrapMode = cc.WrapMode.Normal;\r\n        clip.sample = 10;\r\n        clip.speed = 1;\r\n        this.ani.addClip(clip, name);\r\n    },\r\n\r\n    doMoveAction: function () {\r\n        this.node.active = true;\r\n        this.aniNode.active = true;\r\n        var mt;\r\n        //rotation\r\n        if (this.moveInfo.rotation) {\r\n            let dt = cc.pSub(this.node.position, this.moveInfo.dest);\r\n            //计算角度\r\n            let radian = Math.atan2(dt.x, dt.y);\r\n            let dir = Math.abs(this.aniNode.scaleX) / this.aniNode.scaleX;\r\n            if (-1 === dir) {\r\n                this.node.rotation = (180 * radian / Math.PI + 270) % 360;\r\n            } else {\r\n                this.node.rotation = (180 * radian / Math.PI + 90) % 360;\r\n            }\r\n        }\r\n\r\n        if (1 === this.moveInfo.speedType) {\r\n            mt = cc.moveTo(this.params, this.moveInfo.dest).easing(cc.easeSineIn());\r\n        } else if (2 === this.moveInfo.speedType) {\r\n            mt = cc.moveTo(this.params, this.moveInfo.dest).easing(cc.easeSineOut());\r\n\r\n        } else {\r\n            mt = cc.moveTo(this.params, this.moveInfo.dest);\r\n        }\r\n        this.node.runAction(mt);\r\n    },\r\n\r\n    onDestroy: function () {\r\n        // console.log(\"特效 销毁\", this.aniName);\r\n        this.ani.off('finished', this.onFinished, this);\r\n        AF.EventDispatcher.off(AF.Event.FILE_LOADFRAME, this.onLoadFrameEnded, this);\r\n    },\r\n\r\n    update: function (dt) {\r\n        if (!this.isStart) return;\r\n\r\n        if (EFFECT_TYPE.COUNT === this.type) {\r\n\r\n            if (this.params == Infinity) {\r\n                return;\r\n            }\r\n\r\n            if (this.params <= 0) {\r\n                this.aniNode.active = false;\r\n                this.node.active = false;\r\n                this.working = false;\r\n            }\r\n            return;\r\n        }\r\n        if (EFFECT_TYPE.TIME === this.type) {\r\n            this.params -= dt;\r\n            if (this.params <= 0) {\r\n                this.aniNode.active = false;\r\n                this.node.active = false;\r\n                this.working = false;\r\n            }\r\n            return;\r\n        }\r\n    },\r\n\r\n});\r\n"]}