{"version":3,"sources":["StonePrefab.js"],"names":["stone_velocity_config","low","width","baseDt","minSpeed","maxSpeed","middle","height","cc","Class","extends","Component","properties","sotneSpriteframes","default","type","SpriteFrame","tipsSpriteframes","scoreNode","Node","light","stoneNode","effectPre","Prefab","onLoad","node","setAnchorPoint","opacity","effectNode","instantiate","addChild","effectScript","getComponent","init","setStoneType","effectName","stoneType","active","setNewColor","setStoneRect","setCenterPosition","getStoneRect","getBoundingBox","cAPos","getAnchorPoint","pAPos","x","y","setPosition","sotneSprite","Sprite","spriteFrame","showScore","score","tipType","index","addIconNode","getChildByName","scoreNumNode","Label","string","tipsNode","particleSystem","getComponentInChildren","ParticleSystem","resetSystem","showScoreFadeAction","stopSystem","runAction","sequence","spawn","moveBy","v2","easing","easeBackOut","fadeTo","fadeOut","showLight","stopAllActions","setScale","scaleTo"],"mappings":"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","file":"StonePrefab.js","sourceRoot":"../../../../../../assets/hall/ui/widget","sourcesContent":["\r\nvar stone_velocity_config = {\r\n    low: {\r\n        width: 200,\r\n        baseDt: 0.9,\r\n        minSpeed: 160,\r\n        maxSpeed: 300,\r\n    },\r\n    middle: {\r\n        width: 156,\r\n        baseDt: 0.7,\r\n        minSpeed: 160,\r\n        maxSpeed: 320,\r\n    },\r\n    height: {\r\n        width: 100,\r\n        baseDt: 0.75,\r\n        minSpeed: 200,\r\n        maxSpeed: 400,\r\n    },\r\n};\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        sotneSpriteframes: {\r\n            default: [],\r\n            type: cc.SpriteFrame\r\n        },\r\n        tipsSpriteframes: {\r\n            default: [],\r\n            type: cc.SpriteFrame\r\n        },\r\n        scoreNode: cc.Node,\r\n        light: cc.Node,\r\n        stoneNode: cc.Node,\r\n        effectPre: cc.Prefab,\r\n    },\r\n\r\n\r\n    onLoad: function () {\r\n        this.node.width = 60;\r\n        this.node.height = 40;\r\n        this.node.setAnchorPoint(0.5, 0);\r\n        this.light.opacity = 0;\r\n\r\n        var effectNode = cc.instantiate(this.effectPre);\r\n        this.node.addChild(effectNode);\r\n        this.effectScript = effectNode.getComponent('EffectPrefab');\r\n    },\r\n\r\n    init:function(){\r\n        this.scoreNode.opacity = 0;\r\n    },\r\n\r\n    setStoneType: function (type, effectName) {\r\n        this.stoneType = type;\r\n        switch (type) {\r\n            case 'stone':\r\n                this.stoneNode.active = true;\r\n                this.effectScript.node.active = false;\r\n                this.setNewColor();\r\n                break;\r\n            case 'fireball':\r\n                this.stoneNode.active = false;\r\n                this.effectScript.node.active = true;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    },\r\n\r\n    setStoneRect: function (width, height) {\r\n\r\n        this.node.width = width || 60;\r\n        this.node.height = height || 40;\r\n\r\n        // this.stoneNode.width = width || 60;\r\n        // this.stoneNode.height = height || 40;\r\n\r\n        this.light.width = this.node.width;\r\n        this.light.height = this.node.height;\r\n\r\n        this.setCenterPosition(this.stoneNode);\r\n        this.setCenterPosition(this.effectScript.node);\r\n\r\n    },\r\n\r\n    getStoneRect: function () {\r\n        return this.node.getBoundingBox();\r\n        // this.node.getRect();\r\n        // var a = new cc.Rect(0, 10, 20, 20);\r\n        // var b = new cc.Rect(0, 10, 10, 10);\r\n        // cc.rectIntersectsRect(a, b); // true;\r\n    },\r\n\r\n    setCenterPosition: function (node) {\r\n        var cAPos = node.getAnchorPoint();\r\n        var pAPos = this.node.getAnchorPoint();\r\n        var x = (cAPos.x - pAPos.x) * this.node.width;\r\n        var y = (cAPos.y - pAPos.y) * this.node.height;\r\n        node.setPosition(x, y);\r\n    },\r\n\r\n    setNewColor: function (width) {\r\n        // var r = Math.ceil(Math.random() * 255 * 5) % 256;\r\n        // var g = Math.ceil(Math.random() * 255 * 5) % 256;\r\n        // var b = Math.ceil(Math.random() * 255 * 5) % 256;\r\n        // let color = new cc.Color(r, g, b);\r\n        // this.stoneNode.color = color;\r\n        var sotneSprite = null;\r\n        if (width === stone_velocity_config.low.width) {\r\n            sotneSprite = this.sotneSpriteframes[0];\r\n        } else if (width === stone_velocity_config.middle.width) {\r\n            sotneSprite = this.sotneSpriteframes[1];\r\n        } else if (width === stone_velocity_config.height.width) {\r\n            sotneSprite = this.sotneSpriteframes[2];\r\n        }\r\n        this.stoneNode.getComponent(cc.Sprite).spriteFrame = sotneSprite;\r\n        // if (Math.random() * 10 > 5) {\r\n        //     this.stoneNode.scaleX = -1;\r\n        // } else {\r\n        //     this.stoneNode.scaleX = 1;\r\n        // }\r\n    },\r\n\r\n    showScore: function (score, tipType) {\r\n        // return;\r\n        var index = -1;\r\n        var addIconNode = this.scoreNode.getChildByName(\"addIcon\");\r\n        var scoreNumNode = this.scoreNode.getChildByName(\"scoreNum\");\r\n        scoreNumNode.getComponent(cc.Label).string = '+' + score;\r\n        var tipsNode = this.scoreNode.getChildByName(\"tips\");\r\n        scoreNumNode.x = 10;\r\n        scoreNumNode.y = 36;\r\n        if (index >= 0) {\r\n            tipsNode.active = true;\r\n            tipsNode.getComponent(cc.Sprite).spriteFrame = this.tipsSpriteframes[index];\r\n        } else {\r\n            tipsNode.active = false;\r\n        }\r\n        var particleSystem = this.node.getComponentInChildren(cc.ParticleSystem);\r\n        switch (tipType) {\r\n            case 'normal':\r\n                break;\r\n            case 'danger':\r\n                break;\r\n            case 'perfect':\r\n                particleSystem.resetSystem();\r\n                break;\r\n            case 'goodJob':\r\n                particleSystem.resetSystem();\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        /*addIconNode.x = 15;\r\n        scoreNumNode.x = 52;\r\n        addIconNode.y = 3;\r\n        scoreNumNode.y = 3;\r\n        var particleSystem = this.node.getComponentInChildren(cc.ParticleSystem);\r\n        // particleSystem.posVar.x = 0.7 * this.stoneNode.width;\r\n        // console.log('应该',0.7 * this.stoneNode.width);\r\n        // console.log('particleSystem',particleSystem.posVar);\r\n        switch (tipType) {\r\n            case 'normal':\r\n                index = -1;\r\n                addIconNode.x = 10;\r\n                scoreNumNode.x = 47;\r\n                addIconNode.y = 36;\r\n                scoreNumNode.y = 36;\r\n                break;\r\n            case 'danger':\r\n                index = 0;\r\n                break;\r\n            case 'perfect':\r\n                index = 1;\r\n                particleSystem.resetSystem();\r\n                break;\r\n            case 'goodJob':\r\n                index = 1;\r\n                particleSystem.resetSystem();\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        index = -1;\r\n        addIconNode.x = 10;\r\n        scoreNumNode.x = 47;\r\n        addIconNode.y = 36;\r\n        scoreNumNode.y = 36;\r\n        if (index >= 0) {\r\n            tipsNode.active = true;\r\n            tipsNode.getComponent(cc.Sprite).spriteFrame = this.tipsSpriteframes[index];\r\n        } else {\r\n            tipsNode.active = false;\r\n        }*/\r\n\r\n        var x = this.node.width * 0.5 + 5;\r\n        var y = 0;\r\n        this.scoreNode.setPosition(x, y);\r\n        this.scoreNode.opacity = 255;\r\n    },\r\n\r\n    showScoreFadeAction: function () {\r\n        // return;\r\n        var particleSystem =this.node.getComponentInChildren(cc.ParticleSystem);\r\n        particleSystem.stopSystem ();\r\n        this.scoreNode.runAction(cc.sequence(\r\n            cc.spawn(\r\n                cc.moveBy(0.4, cc.v2(60, 0)).easing(cc.easeBackOut()),\r\n                cc.fadeTo(0.4, 150)),\r\n            cc.fadeOut(1 / 60)\r\n        ));\r\n    },\r\n    \r\n    showLight: function () {\r\n        this.light.stopAllActions()\r\n        this.light.width = this.node.width;\r\n        this.light.height = this.node.height;\r\n        this.light.setScale(0.85);\r\n        this.light.opacity = 0;\r\n        this.light.runAction(cc.sequence(\r\n            cc.fadeTo(0.08, 255 * 0.95),\r\n            cc.scaleTo(0.1, 1.1),\r\n            cc.spawn(\r\n                cc.fadeTo(0.36, 0),\r\n                cc.scaleTo(0.36, 1.5),\r\n            )\r\n        ));\r\n    },\r\n});\r\n"]}