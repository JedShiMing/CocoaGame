{"version":3,"sources":["SpriteFontPrefab.js"],"names":["HORIZONTAL_ALIGNMENT","cc","Enum","LEFT","CENTER","RIGHT","VERTICAL_ALIGNMENT","TOP","BOTTOM","spriteFilename","Class","extends","Component","properties","spriteFonts","SpriteAtlas","onLoad","spriteFrameArray","createNewLabel","contentText","fileName","hAlignment","vAlignment","spriteAtlasPath","node","destroyAllChildren","length","initUI","loadAtlas","then","Promise","resolve","reject","loader","loadRes","err","atlas","resArray","getSpriteFrames","i","spriteFrame","name","width","height","contentNode","Node","setAnchorPoint","addChild","a","charAt","key","sp","addComponent","Sprite","trim","sizeMode","x","setPosition","anchorX","anchorY"],"mappings":"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","file":"SpriteFontPrefab.js","sourceRoot":"../../../../../../assets/hall/ui/widget","sourcesContent":["const HORIZONTAL_ALIGNMENT = cc.Enum({\r\n    LEFT: -1,\r\n    CENTER: -1,\r\n    RIGHT: -1,\r\n});\r\nconst VERTICAL_ALIGNMENT = cc.Enum({\r\n    TOP: -1,\r\n    CENTER: -1,\r\n    BOTTOM: -1,\r\n});\r\n\r\nconst spriteFilename = {\r\n    \"default\": \"hall/font/spriteNum\"\r\n};\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        spriteFonts: cc.SpriteAtlas,\r\n    },\r\n\r\n    onLoad: function () {\r\n        this.spriteFrameArray = [];\r\n    },\r\n\r\n    createNewLabel: function (contentText, fileName, hAlignment, vAlignment) {\r\n\r\n        var spriteAtlasPath = spriteFilename[fileName] || spriteFilename['default'];\r\n        this.hAlignment = hAlignment || HORIZONTAL_ALIGNMENT.CENTER;\r\n        this.vAlignment = vAlignment || this.hAlignment;\r\n\r\n        if (this.spriteAtlasPath === spriteAtlasPath) {\r\n\r\n            if (this.contentText === contentText) { return; }\r\n\r\n            this.contentText = contentText;\r\n            this.node.destroyAllChildren();\r\n\r\n            if (this.contentText.length < 0) { return; }\r\n\r\n            this.initUI();\r\n            return;\r\n        }\r\n\r\n        this.spriteAtlasPath = spriteAtlasPath;\r\n        this.contentText = contentText;\r\n        this.node.destroyAllChildren();\r\n\r\n        if (this.contentText.length < 0) { return; }\r\n\r\n        this.loadAtlas(this.spriteAtlasPath).then((spriteFrameArray) => {\r\n            this.spriteFrameArray = spriteFrameArray;\r\n            this.initUI();\r\n        });\r\n\r\n    },\r\n\r\n    loadAtlas: function (spriteAtlasPath) {\r\n        return new Promise((resolve, reject) => {\r\n            cc.loader.loadRes(spriteAtlasPath, cc.SpriteAtlas, function (err, atlas) {\r\n                if (err) {\r\n                    reject('Could not load image at ' + spriteAtlasPath);\r\n                    return;\r\n                }\r\n                //精灵帧数组\r\n                var resArray = atlas.getSpriteFrames();\r\n                var spriteFrameArray = [];\r\n                for (let i = 0; i < resArray.length; i++) {\r\n                    let spriteFrame = resArray[i];\r\n                    spriteFrameArray[spriteFrame.name] = spriteFrame;\r\n                }\r\n                resolve(spriteFrameArray);\r\n            });\r\n        });\r\n    },\r\n\r\n    initUI: function () {\r\n        var width = 0;\r\n        var height = 0;\r\n\r\n        let contentNode = new cc.Node('contentNode');\r\n        contentNode.setAnchorPoint(0, 0.5);\r\n        this.node.addChild(contentNode);\r\n\r\n        for (let i = 0; i < this.contentText.length; i++) {\r\n            let a = this.contentText.charAt(i);\r\n            let key = a;\r\n            if ('/' == key) {\r\n                key = 'chu';\r\n            }\r\n            let node = new cc.Node('Sprite' + i);\r\n            let sp = node.addComponent(cc.Sprite);\r\n            sp.trim = false;\r\n            sp.sizeMode = 2;\r\n            contentNode.addChild(node);\r\n            sp.spriteFrame = this.spriteFrameArray[key];\r\n            node.x = width + node.width / 2;\r\n            width = node.x + node.width / 2;\r\n            height = node.height;\r\n        }\r\n        contentNode.width = width;\r\n        contentNode.height = height;\r\n        contentNode.setPosition(width * (contentNode.anchorX - this.node.anchorX), height * (0.5 - contentNode.anchorY));\r\n        this.node.width = width;\r\n        this.node.height = height;\r\n    },\r\n\r\n});"]}