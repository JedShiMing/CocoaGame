{"version":3,"sources":["HallLoginScene.js"],"names":["VERSION_FILE","STEP","LAUNCH_FAIL","LAUNCH_INIT","LOCAL_VERSION","REMOTE_VERSION","WAIT_REMOTE_VERSION","FILELIST_AND_VERSION","WAIT_FILELIST_AND_VERSION","LOAD_CONFIG","WAIT_LOAD_CONFIG","START_LOGIN","WAIT_LOGIN_RESULT","GET_USER_INFO","WAIT_USER_INFO","GOTO_MAINSCENE","WAIT_NEWBIE_DIALOG","LAUNCH_END","cc","Class","extends","Component","properties","stratButton","Node","version","Label","onLoad","localVersion","step","tryTimes","fileList","AF","EventDispatcher","on","Event","FILE_DOWNLOAD","_loadAndCheckVersion","DOWNLOADDIAGLOG_ON_CLOSE","_downloadFilelist","active","schedule","onGameBGM","onEnable","setEnableSwitchSceneAnim","strVersion","platform","getDisplayVersion","string","isHairScreen","node","getComponent","Widget","right","emit","SCENE_LOADED","isVideoAdOpen","util","start","setKeepScreenOn","params","SCENE_PARAMS","change","GameData","init","GameConfig","firstLoad","dt","GAME_ON_BGM","onDisable","onDestroy","off","_loadLocalVersionFile","isLocalFileExist","self","loader","load","getLocalFilePath","err","res","console","log","errMsg","_startLoadRemoteVersionFile","Downloader","startDownloadFile","filename","tempFilePath","state","makesureLocalPath2","url","getLocalFilePath2","saveLocalFile","files","warn","downloadState","_saveRemoteVersionFile","SHOW_LOGIN_PROGRESS_DIALOG","isWxApp","isQQApp","copyLocalFile","_loadConfigFileList","configList","index","_startLoadConfig","length","cfg","getRemoteUrl","setGameConfig","update","openLoginProgressDialog","openDialog","queryObject","setMyObject","MessageBox","OK","ret","RET_OK","OPENID","getStorage","login","openid","error","getMyObject","gotoScene"],"mappings":"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","file":"HallLoginScene.js","sourceRoot":"../../../../../../assets/hall/ui/scene","sourcesContent":["const VERSION_FILE = \"version.json\";\r\n\r\nconst STEP = {\r\n    LAUNCH_FAIL: -1,\r\n    LAUNCH_INIT: 0,\r\n    LOCAL_VERSION: 1,\r\n    REMOTE_VERSION: 2,\r\n    WAIT_REMOTE_VERSION: 3,\r\n    FILELIST_AND_VERSION: 4,\r\n    WAIT_FILELIST_AND_VERSION: 5,\r\n    LOAD_CONFIG: 6,\r\n    WAIT_LOAD_CONFIG: 7,\r\n    START_LOGIN: 8,\r\n    WAIT_LOGIN_RESULT: 9,\r\n    GET_USER_INFO: 10,\r\n    WAIT_USER_INFO: 11,\r\n    GOTO_MAINSCENE: 12,\r\n    WAIT_NEWBIE_DIALOG: 13,\r\n    LAUNCH_END: 14,\r\n};\r\n/**\r\n * 0 init\r\n * 1 读取本地version.json\r\n * 2 下载并读取远程version.json，并且比较版本\r\n * 3 step2 waiting\r\n * 4 下载资源文件列表，保存version.json \r\n * 5 step4 waiting\r\n * 6 读取配置文件\r\n * 7 step6 waiting\r\n * 8 发起登录请求\r\n * 9 step8 waiting\r\n * 10 获取用户信息\r\n * 11 step10 waiting\r\n * 12 进入主界面\r\n * 13 end\r\n */\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        stratButton: cc.Node,\r\n        version: cc.Label,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        \r\n        this.localVersion = 0;\r\n        this.step = STEP.LAUNCH_INIT;\r\n        this.tryTimes = 0;\r\n        this.fileList = [];\r\n\r\n        AF.EventDispatcher.on(AF.Event.FILE_DOWNLOAD, this._loadAndCheckVersion, this);\r\n        AF.EventDispatcher.on(AF.Event.DOWNLOADDIAGLOG_ON_CLOSE, this._downloadFilelist, this);\r\n\r\n        this.stratButton.active = false;\r\n\r\n        this.schedule(this.onGameBGM, 0.1, this);\r\n    },\r\n\r\n    onEnable: function () {\r\n        AF.setEnableSwitchSceneAnim(true);\r\n\r\n        var strVersion = AF.platform.getDisplayVersion();\r\n\r\n        this.version.string = strVersion;\r\n\r\n        if (AF.platform.isHairScreen()) {\r\n            this.version.node.getComponent(cc.Widget).right = 20;\r\n        }\r\n\r\n        this.localVersion = 0;\r\n        this.step = STEP.LAUNCH_INIT;\r\n        this.tryTimes = 0;\r\n        this.fileList = [];\r\n\r\n        AF.EventDispatcher.emit(AF.Event.SCENE_LOADED);\r\n\r\n        var isVideoAdOpen = AF.util.isVideoAdOpen();\r\n\r\n        AF.platform.start(isVideoAdOpen);\r\n        AF.platform.setKeepScreenOn();\r\n\r\n        var params = AF.SCENE_PARAMS();\r\n        this.change = (params && params.change) || false;\r\n        if (this.change) {\r\n            this.step = STEP.GOTO_MAINSCENE;\r\n        } else {\r\n            AF.GameData.init();\r\n            AF.GameConfig.init();\r\n        }\r\n\r\n        this.firstLoad = (params && params.firstLoad) || false;\r\n    },\r\n\r\n    onGameBGM: function (dt) {\r\n        AF.EventDispatcher.emit(AF.Event.GAME_ON_BGM);\r\n    },\r\n\r\n    onDisable: function () {\r\n    },\r\n\r\n    onDestroy: function () {\r\n        AF.EventDispatcher.off(AF.Event.FILE_DOWNLOAD, this._loadAndCheckVersion, this);\r\n        AF.EventDispatcher.off(AF.Event.DOWNLOADDIAGLOG_ON_CLOSE, this._downloadFilelist, this);\r\n    },\r\n\r\n    _loadLocalVersionFile: function () {\r\n\r\n        if (this.step !== STEP.LOCAL_VERSION) return;\r\n\r\n        if (!AF.util.isLocalFileExist(VERSION_FILE)) {\r\n            //VERSION_FILE不存在 拉取远程VERSION_FILE\r\n            this.localVersion = 0;\r\n            this.step = STEP.REMOTE_VERSION;\r\n            return;\r\n        }\r\n\r\n        var self = this;\r\n        try {\r\n            cc.loader.load(AF.util.getLocalFilePath(VERSION_FILE), function (err, res) {\r\n                if (err) {\r\n                    throw err;\r\n                }\r\n                self.localVersion = res.version;\r\n                self.step = STEP.REMOTE_VERSION;\r\n                console.log(\"【本地版本文件内容】\", res);\r\n                console.log(\"HallLoginScene.js _loadLocalVersionFile localVersion:\", self.localVersion);\r\n            });\r\n\r\n        } catch (errMsg) {\r\n            console.log(\"【错误:读取本地版本文件出错】\");\r\n            console.log(\"【读取路径：\" + AF.util.getLocalFilePath(VERSION_FILE) + \"】\");\r\n            console.log(\"【错误信息】\", errMsg);\r\n            self.localVersion = 0;\r\n            self.step = STEP.REMOTE_VERSION;\r\n        }\r\n    },\r\n\r\n    _startLoadRemoteVersionFile: function () {\r\n        if (this.step !== STEP.WAIT_REMOTE_VERSION) return;\r\n        AF.Downloader.startDownloadFile(VERSION_FILE, true);\r\n    },\r\n\r\n    _loadAndCheckVersion: function (filename, tempFilePath, state) {\r\n        if (this.step !== STEP.WAIT_REMOTE_VERSION) return;\r\n        if (VERSION_FILE !== filename) return;\r\n        if (!state) {\r\n            //下载失败\r\n            console.log(\"err HallLoginScene.js _loadAndCheckVersion \", filename, tempFilePath, state);\r\n            this.step = STEP.LAUNCH_INIT;\r\n            return;\r\n        }\r\n        \r\n        AF.util.makesureLocalPath2(\"temp/\");\r\n        var url = AF.util.getLocalFilePath2(\"temp/\" + VERSION_FILE);\r\n\r\n        AF.util.saveLocalFile(tempFilePath, url);\r\n\r\n        var self = this;\r\n\r\n        try {\r\n            cc.loader.load(url, function (err, res) {\r\n                if (err) {\r\n                    throw err;\r\n                }\r\n                console.log(\"【远程版本文件内容】\", res);\r\n                console.log(\"【远程版本文件版本】\", res.version);\r\n                console.log(\"【远程版本文件列表】\", res.files);\r\n                console.log(\"【本地版本】\", res.version);\r\n                if (self.localVersion !== res.version) {\r\n                    self.fileList = res.files;\r\n                    self.tempFilePath = url;\r\n                    console.log(\"【远程版本文件版本与本地不同】\");\r\n                    console.log(\"【远程版本文件版本与本地不同】\");\r\n                } else {\r\n                    self.tempFilePath = null;\r\n                    console.log(\"【远程版本文件版本与本地相同】\");\r\n                }\r\n\r\n                self.step = STEP.FILELIST_AND_VERSION;\r\n            });\r\n        } catch (errMsg) {\r\n            console.warn(\"【错误:读取远程文件临时文件出错】\");\r\n            console.warn(\"【读取路径：\" + url + \"】\");\r\n            console.warn(\"【错误信息】\", errMsg);\r\n            self.localVersion = 0;\r\n            self.step = STEP.LAUNCH_INIT;\r\n        }\r\n    },\r\n\r\n    _downloadFilelist: function (downloadState) {\r\n        if (this.step !== STEP.WAIT_FILELIST_AND_VERSION) return;\r\n        if (downloadState) {\r\n            this._saveRemoteVersionFile();\r\n            this.step = STEP.LOAD_CONFIG;\r\n            AF.EventDispatcher.emit(AF.Event.SHOW_LOGIN_PROGRESS_DIALOG, 3, 40);\r\n        } else {\r\n            console.log(\"err HallLoginScene.js _downloadFilelist \", downloadState);\r\n            this.step = STEP.LAUNCH_INIT;\r\n        }\r\n    },\r\n\r\n    _saveRemoteVersionFile: function () {\r\n        if (this.step !== STEP.WAIT_FILELIST_AND_VERSION) return;\r\n        if (!AF.platform.isWxApp() && !AF.platform.isQQApp()) {\r\n            this.step = STEP.LOAD_CONFIG;\r\n            return;\r\n        }\r\n        if (!this.tempFilePath) {\r\n            this.step = STEP.LOAD_CONFIG;\r\n            return;\r\n        }\r\n\r\n        AF.util.copyLocalFile(this.tempFilePath, AF.util.getLocalFilePath(VERSION_FILE));\r\n\r\n        this.step = STEP.LOAD_CONFIG;\r\n    },\r\n\r\n    _loadConfigFileList: function () {\r\n        if (this.step !== STEP.WAIT_LOAD_CONFIG) return;\r\n        this.configList = [\r\n            \"model\",\r\n            \"player\",\r\n            \"point\"\r\n        ];\r\n\r\n        this.index = 0;\r\n        this._startLoadConfig();\r\n    },\r\n\r\n    _startLoadConfig: function () {\r\n        if (this.step !== STEP.WAIT_LOAD_CONFIG) return;\r\n        if (this.index >= this.configList.length) {\r\n            // 配置加载完成\r\n            this.step = STEP.START_LOGIN;\r\n            AF.EventDispatcher.emit(AF.Event.SHOW_LOGIN_PROGRESS_DIALOG, 3, 60);\r\n \r\n            return;\r\n        }\r\n        var cfg = \"config/\" + this.configList[this.index] + \"_config.json\";\r\n        console.log(\"开始加载配置文件\" + cfg + \"...\");\r\n        var url;\r\n\r\n        if (AF.platform.isWxApp() || AF.platform.isQQApp()) {\r\n            url = AF.util.getLocalFilePath(cfg);\r\n        } else {\r\n            url = AF.util.getRemoteUrl(cfg);\r\n        }\r\n        var self = this;\r\n        cc.loader.load(url, function (err, res) {\r\n            if (err) {\r\n                console.log(\"err HallLoginScene.js _startLoadConfig \", err);\r\n                self.step = STEP.LAUNCH_INIT;\r\n                return;\r\n            }\r\n\r\n            AF.GameConfig.setGameConfig(self.configList[self.index], res);\r\n\r\n            self.index++;\r\n            self._startLoadConfig();\r\n        });\r\n    },\r\n\r\n    update: function (dt) {\r\n        var self = this;\r\n        if (!self.openLoginProgressDialog) {\r\n            AF.EventDispatcher.emit(AF.Event.SCENE_LOADED);\r\n            AF.openDialog(\"LoginProgressDialog\");\r\n            self.openLoginProgressDialog = true;\r\n        }\r\n\r\n        if (!AF.util.queryObject(\"LoginProgressDialog\")) {\r\n            return;\r\n        }\r\n\r\n        if (STEP.LAUNCH_INIT === self.step) {\r\n\r\n            console.log(\"开始启动游戏\");\r\n            AF.GameData.setMyObject(\"LoginProgressDialogFinish\", false);\r\n            self.stratButton.active = false;\r\n\r\n            AF.EventDispatcher.emit(AF.Event.SHOW_LOGIN_PROGRESS_DIALOG, 1, 10);\r\n\r\n            if (self.tryTimes > 3) {\r\n                self.step = STEP.LAUNCH_FAIL;\r\n                console.log(\"启动失败\");\r\n                console.log(\"HallLoginScene.js update  err: try too many times\");\r\n                AF.MessageBox.OK(\"启动失败\", \"点击确定重试！\", (ret) => {\r\n                    if (ret === AF.MessageBox.RET_OK) {\r\n                        self.tryTimes = 0;\r\n                        self.step = STEP.LAUNCH_INIT;\r\n                    }\r\n                }, \"\", false);\r\n                return;\r\n            } else if (self.tryTimes == 3) {\r\n                console.log(\"重试次数超过3次\");\r\n                self.tryTimes++;\r\n                return;\r\n            } else {\r\n                self.tryTimes++;\r\n            }\r\n            if (AF.platform.isWxApp() || AF.platform.isQQApp()) {\r\n                console.log(\"开始读取本地配置文件\");\r\n                self.step = STEP.LOCAL_VERSION;\r\n                self._loadLocalVersionFile();\r\n            } else {\r\n                console.log(\"浏览器平台\");\r\n                self.step = STEP.FILELIST_AND_VERSION;\r\n            }\r\n        } else if (STEP.REMOTE_VERSION === self.step) {\r\n            console.log(\"读取远程配置文件并比较版本差异，并保存最新的版本文件\");\r\n            self.step = STEP.WAIT_REMOTE_VERSION;\r\n            self._startLoadRemoteVersionFile();\r\n            return;\r\n        } else if (STEP.FILELIST_AND_VERSION === self.step) {\r\n            console.log(\"开始下载资源文件列表，保存version.json\");\r\n            self.step = STEP.WAIT_FILELIST_AND_VERSION;\r\n            AF.EventDispatcher.emit(AF.Event.SHOW_LOGIN_PROGRESS_DIALOG, 2, 30, self.fileList);\r\n            return;\r\n        } else if (STEP.LOAD_CONFIG === self.step) {\r\n            console.log(\"开始加载配置文件...\");\r\n            self.step = STEP.WAIT_LOAD_CONFIG;\r\n            self._loadConfigFileList();\r\n            return;\r\n        } else if (STEP.START_LOGIN === self.step) {\r\n            console.log(\"开始连接服务器...\");\r\n            // AF.audio.playDefaultBGM();\r\n            AF.EventDispatcher.emit(AF.Event.SHOW_LOGIN_PROGRESS_DIALOG, 3, 100);\r\n\r\n            self.step = STEP.WAIT_LOGIN_RESULT;\r\n            var OPENID = AF.util.getStorage('openId');\r\n            if (OPENID) {\r\n                self.step = STEP.GET_USER_INFO;\r\n                return;\r\n            }\r\n            AF.util.login((openid) => {\r\n                OPENID = openid\r\n                console.error('openid', OPENID);\r\n                self.step = STEP.GET_USER_INFO;\r\n            }, (errMsg) => {\r\n                console.error(errMsg);\r\n                self.step = STEP.LAUNCH_INIT;\r\n            });\r\n        } else if (STEP.GET_USER_INFO === self.step) {\r\n            console.log(\"获取用户信息\");\r\n            self.step = STEP.WAIT_USER_INFO;\r\n            self.step = STEP.GOTO_MAINSCENE;\r\n        } else if (STEP.GOTO_MAINSCENE === self.step) {\r\n            if (AF.GameData.getMyObject(\"LoginProgressDialogFinish\")) {\r\n                self.step = STEP.LAUNCH_END;\r\n                console.log(\"等待 进入主界面或新手引导界面\");\r\n                AF.gotoScene('HallMainScene');\r\n            }\r\n        }\r\n    },\r\n});\r\n"]}