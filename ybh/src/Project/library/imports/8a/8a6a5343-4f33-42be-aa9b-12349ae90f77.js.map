{"version":3,"sources":["../../../../../../assets/framework/ui/mgr/assets/framework/ui/mgr/af-notice-mgr.js"],"names":["Const","require","Notice","DEFAULT_MARQUEE_MSG_INTERVAL","registerMarqueeWidget","com","_marqueeWidget","unregisterMarqueeWidget","undefined","marquee","text","repeat","interval","_marqueeMsg","push","time","_tickHandle","setInterval","_tick","bind","_showMarquee","show","_checkMarqueeMsgQueue","i","length","v","splice","module","exports","window","AF"],"mappings":";;;;;;AAAA;;;;AAIA,IAAIA,QAAQC,QAAQ,UAAR,CAAZ;;AAEA,IAAIC,SAAS,EAAb;;AAEA,IAAIC,+BAA+B,EAAnC,EAAwC;;AAExCD,OAAOE,qBAAP,GAA+B,UAASC,GAAT,EAAc;AACzC,SAAKC,cAAL,GAAsBD,GAAtB;AACH,CAFD;;AAIAH,OAAOK,uBAAP,GAAiC,YAAW;AACxC,SAAKD,cAAL,GAAsBE,SAAtB;AACH,CAFD;;AAIA;;;;;;AAMAN,OAAOO,OAAP,GAAiB,UAAUC,IAAV,EAAgBC,MAAhB,EAAwBC,QAAxB,EAAkC;AAC/C,SAAKC,WAAL,GAAmB,KAAKA,WAAL,IAAoB,EAAvC;AACA,QAAIF,MAAJ,EAAY;AACR,aAAKE,WAAL,CAAiBC,IAAjB,CAAsB;AAClBJ,kBAAMA,IADY;AAElBC,oBAAQA,SAAS,CAFC;AAGlBC,sBAAUA,YAAYT,4BAHJ;AAIlBY,kBAAMH,YAAYT;AAJA,SAAtB;AAMA,YAAI,CAAC,KAAKa,WAAV,EAAuB;AACnB,iBAAKA,WAAL,GAAmBC,YAAY,KAAKC,KAAL,CAAWC,IAAX,CAAgB,IAAhB,CAAZ,EAAmC,IAAnC,CAAnB;AACH;AACJ;;AAED,SAAKC,YAAL,CAAkBV,IAAlB;AACH,CAfD;;AAiBAR,OAAOkB,YAAP,GAAsB,UAASV,IAAT,EAAe;AACjC,QAAI,KAAKJ,cAAT,EAAyB;AACrB,aAAKA,cAAL,CAAoBe,IAApB,CAAyBX,IAAzB;AACH;AACJ,CAJD;;AAMAR,OAAOoB,qBAAP,GAA+B,YAAW;AACtC,QAAIC,IAAI,CAAR;AACA,WAAO,IAAP,EAAa;AACT,YAAIA,KAAK,KAAKV,WAAL,CAAiBW,MAA1B,EAAkC;AAC9B;AACH;;AAED,YAAIC,IAAI,KAAKZ,WAAL,CAAiBU,CAAjB,CAAR;AACAE,UAAEV,IAAF,IAAU,CAAV;AACA,YAAIU,EAAEV,IAAF,IAAU,CAAd,EAAiB;AACbU,cAAEV,IAAF,GAASU,EAAEb,QAAX;AACAa,cAAEd,MAAF,GAAWc,EAAEd,MAAF,GAAW,CAAX,GAAec,EAAEd,MAAF,GAAW,CAA1B,GAA8Bc,EAAEd,MAA3C;AACA,iBAAKS,YAAL,CAAkBK,EAAEf,IAApB;AACA,gBAAIe,EAAEd,MAAF,IAAY,CAAhB,EAAmB;AACf,qBAAKE,WAAL,CAAiBa,MAAjB,CAAwBH,CAAxB,EAA2B,CAA3B;AACH,aAFD,MAEO;AACHA;AACH;AACJ,SATD,MASO;AACHA;AACH;AACJ;AACJ,CAtBD;;AAwBArB,OAAOgB,KAAP,GAAe,YAAW;AACtB,QAAI,KAAKL,WAAT,EAAsB;AAClB,aAAKS,qBAAL;AACH;AACJ,CAJD;;AAMAK,OAAOC,OAAP,GAAkB,CAACC,OAAOC,EAAP,GAAYD,OAAOC,EAAP,IAAa,EAA1B,EAA8B5B,MAA9B,GAAuCA,MAAzD","file":"af-notice-mgr.js","sourceRoot":"../../../../../../assets/framework/ui/mgr","sourcesContent":["/**\r\n * 通知消息管理器\r\n */\r\n\r\nvar Const = require(\"af-const\");\r\n\r\nvar Notice = {};\r\n\r\nvar DEFAULT_MARQUEE_MSG_INTERVAL = 10;  // 默认重复播放的跑马灯消息间隔时间\r\n\r\nNotice.registerMarqueeWidget = function(com) {\r\n    this._marqueeWidget = com;\r\n};\r\n\r\nNotice.unregisterMarqueeWidget = function() {\r\n    this._marqueeWidget = undefined;\r\n};\r\n\r\n/**\r\n * 跑马灯消息\r\n * @param text {String} 消息文本（支持富文本）\r\n * @param repeat {Number} 重复次数 -1:为一直重复\r\n * @param interval {Number} 重复间隔时间(秒)\r\n */\r\nNotice.marquee = function (text, repeat, interval) {\r\n    this._marqueeMsg = this._marqueeMsg || [];\r\n    if (repeat) {\r\n        this._marqueeMsg.push({\r\n            text: text,\r\n            repeat: repeat - 1,\r\n            interval: interval || DEFAULT_MARQUEE_MSG_INTERVAL,\r\n            time: interval || DEFAULT_MARQUEE_MSG_INTERVAL,\r\n        });\r\n        if (!this._tickHandle) {\r\n            this._tickHandle = setInterval(this._tick.bind(this), 1000);\r\n        }\r\n    }\r\n\r\n    this._showMarquee(text);\r\n};\r\n\r\nNotice._showMarquee = function(text) {\r\n    if (this._marqueeWidget) {\r\n        this._marqueeWidget.show(text);\r\n    }\r\n};\r\n\r\nNotice._checkMarqueeMsgQueue = function() {\r\n    var i = 0;\r\n    while (true) {\r\n        if (i >= this._marqueeMsg.length) {\r\n            break;\r\n        }\r\n\r\n        var v = this._marqueeMsg[i];\r\n        v.time -= 1;\r\n        if (v.time <= 0) {\r\n            v.time = v.interval;\r\n            v.repeat = v.repeat > 0 ? v.repeat - 1 : v.repeat;\r\n            this._showMarquee(v.text);\r\n            if (v.repeat == 0) {\r\n                this._marqueeMsg.splice(i, 1);\r\n            } else {\r\n                i++;\r\n            }\r\n        } else {\r\n            i++;\r\n        }\r\n    }\r\n};\r\n\r\nNotice._tick = function() {\r\n    if (this._marqueeMsg) {\r\n        this._checkMarqueeMsgQueue();\r\n    }\r\n};\r\n\r\nmodule.exports =  (window.AF = window.AF || {}).Notice = Notice;"]}