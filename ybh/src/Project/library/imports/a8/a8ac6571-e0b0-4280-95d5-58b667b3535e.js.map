{"version":3,"sources":["../../../../../../assets/framework/ui/mgr/assets/framework/ui/mgr/af-loading-layer-mgr.js"],"names":["Const","require","EventDispatcher","Event","DEFAULT_TIME_OUT","DEFAULT_MESSAGE_BOX_STYLE_NAME","_styles","LoadingLayer","addStyle","name","prefabName","AF","preloadDialog","resetDefaultStyle","undefined","show","params","emit","SHOW_LOADING_LAYER","_closeLoadingLayer","HIDE_LOADING_LAYER","_tick","_totalTime","cb","_timeupCB","_onSwitchScene","_tickHandle","clearInterval","_curLoadingLayer","_releaseProtos","_openningLoadingLayer","on","BEFORE_SCENE_LAUNCH","once","GAME_LOADED","LOADING_LAYER","bind","CLOSE_LOADING_LAYER","module","exports","window"],"mappings":";;;;;;AAAA;;;;AAIA,IAAIA,QAAQC,QAAQ,UAAR,CAAZ;AACA,IAAIC,kBAAkBD,QAAQ,qBAAR,CAAtB;AACA,IAAIE,QAAQF,QAAQ,UAAR,CAAZ;;AAEA,IAAIG,mBAAmB,CAAvB;AACA,IAAIC,iCAAiC,0BAArC;AACA,IAAIC,UAAU,EAAd;;AAEA,IAAIC,eAAe,EAAnB;;AAEA;AACAA,aAAaC,QAAb,GAAwB,UAAUC,IAAV,EAAgBC,UAAhB,EAA4B;AAChDJ,YAAQG,IAAR,IAAgBC,UAAhB;AACAC,OAAGC,aAAH,CAAiBF,UAAjB;AACH,CAHD;;AAKA;AACAH,aAAaM,iBAAb,GAAiC,UAAUH,UAAV,EAAsB;AACnDJ,YAAQ,SAAR,IAAqBQ,SAArB;AACA,QAAIJ,UAAJ,EAAgB;AACZ,aAAKF,QAAL,CAAc,SAAd,EAAyBE,UAAzB;AACH;AACJ,CALD;;AAOAH,aAAaQ,IAAb,GAAoB,UAAUC,MAAV,EAAkB;AAClCA,aAASA,UAAU,EAAnB;AACAL,OAAGT,eAAH,CAAmBe,IAAnB,CAAwBN,GAAGR,KAAH,CAASe,kBAAjC,EAAqDF,MAArD;AACH,CAHD;;AAKAT,aAAaY,kBAAb,GAAkC,YAAY;AAC1CR,OAAGT,eAAH,CAAmBe,IAAnB,CAAwBN,GAAGR,KAAH,CAASiB,kBAAjC;AACH,CAFD;;AAIAb,aAAac,KAAb,GAAqB,YAAY;AAC7B,QAAI,KAAKC,UAAT,EAAqB;AACjB,aAAKA,UAAL,IAAmB,CAAnB;AACA,YAAI,KAAKA,UAAL,IAAmB,CAAvB,EAA0B;AACtB,gBAAIC,KAAK,KAAKC,SAAd;AACAD,kBAAMA,IAAN;AACA,iBAAKJ,kBAAL;AACH;AACJ;AACJ,CATD;;AAWAZ,aAAakB,cAAb,GAA8B,YAAY;AACtC,SAAKN,kBAAL;AACA,SAAKO,WAAL,IAAoBC,cAAc,KAAKD,WAAnB,CAApB;AACA,SAAKE,gBAAL,GAAwB,KAAKC,cAAL,GAAsB,KAAKL,SAAL,GAAiB,KAAKF,UAAL,GAAkBR,SAAjF;AACA,SAAKY,WAAL,GAAmBZ,SAAnB;AACA,SAAKgB,qBAAL,GAA6B,KAA7B;AACH,CAND;;AAQAnB,GAAGT,eAAH,CAAmB6B,EAAnB,CAAsBpB,GAAGR,KAAH,CAAS6B,mBAA/B,EAAoDzB,aAAakB,cAAjE,EAAiFlB,YAAjF;;AAEA;AACAL,gBAAgB+B,IAAhB,CAAqB9B,MAAM+B,WAA3B,EAAwC,YAAY;AAChD3B,iBAAaC,QAAb,CAAsB,WAAtB,EAAmCH,8BAAnC;AACH,CAFD;;AAIAM,GAAGwB,aAAH,GAAmB5B,aAAaQ,IAAb,CAAkBqB,IAAlB,CAAuB7B,YAAvB,CAAnB;AACAI,GAAG0B,mBAAH,GAAyB9B,aAAaY,kBAAb,CAAgCiB,IAAhC,CAAqC7B,YAArC,CAAzB;;AAEA+B,OAAOC,OAAP,GAAiB,CAACC,OAAO7B,EAAP,GAAY6B,OAAO7B,EAAP,IAAa,EAA1B,EAA8BJ,YAA9B,GAA6CA,YAA9D","file":"af-loading-layer-mgr.js","sourceRoot":"../../../../../../assets/framework/ui/mgr","sourcesContent":["/**\r\n * loading层管理器\r\n */\r\n\r\nvar Const = require(\"af-const\");\r\nvar EventDispatcher = require(\"af-event-dispatcher\");\r\nvar Event = require(\"af-event\");\r\n\r\nvar DEFAULT_TIME_OUT = 8;\r\nvar DEFAULT_MESSAGE_BOX_STYLE_NAME = 'DefaultLoadingLayerStyle';\r\nvar _styles = {};\r\n\r\nvar LoadingLayer = {};\r\n\r\n// 添加样式\r\nLoadingLayer.addStyle = function (name, prefabName) {\r\n    _styles[name] = prefabName;\r\n    AF.preloadDialog(prefabName);\r\n};\r\n\r\n// 重置默认样式\r\nLoadingLayer.resetDefaultStyle = function (prefabName) {\r\n    _styles['default'] = undefined;\r\n    if (prefabName) {\r\n        this.addStyle('default', prefabName);\r\n    }\r\n};\r\n\r\nLoadingLayer.show = function (params) {\r\n    params = params || {};\r\n    AF.EventDispatcher.emit(AF.Event.SHOW_LOADING_LAYER, params);\r\n};\r\n\r\nLoadingLayer._closeLoadingLayer = function () {\r\n    AF.EventDispatcher.emit(AF.Event.HIDE_LOADING_LAYER);\r\n};\r\n\r\nLoadingLayer._tick = function () {\r\n    if (this._totalTime) {\r\n        this._totalTime -= 1;\r\n        if (this._totalTime <= 0) {\r\n            var cb = this._timeupCB;\r\n            cb && cb();\r\n            this._closeLoadingLayer();\r\n        }\r\n    }\r\n};\r\n\r\nLoadingLayer._onSwitchScene = function () {\r\n    this._closeLoadingLayer();\r\n    this._tickHandle && clearInterval(this._tickHandle);\r\n    this._curLoadingLayer = this._releaseProtos = this._timeupCB = this._totalTime = undefined;\r\n    this._tickHandle = undefined;\r\n    this._openningLoadingLayer = false;\r\n};\r\n\r\nAF.EventDispatcher.on(AF.Event.BEFORE_SCENE_LAUNCH, LoadingLayer._onSwitchScene, LoadingLayer);\r\n\r\n// 加载框架默认的吐司消息样式\r\nEventDispatcher.once(Event.GAME_LOADED, function () {\r\n    LoadingLayer.addStyle('_default_', DEFAULT_MESSAGE_BOX_STYLE_NAME);\r\n});\r\n\r\nAF.LOADING_LAYER = LoadingLayer.show.bind(LoadingLayer);\r\nAF.CLOSE_LOADING_LAYER = LoadingLayer._closeLoadingLayer.bind(LoadingLayer);\r\n\r\nmodule.exports = (window.AF = window.AF || {}).LoadingLayer = LoadingLayer;"]}