{"version":3,"sources":["../../../../../assets/framework/platform/assets/framework/platform/af-wx-helper.js"],"names":["self","videoConfig","power","adUnitId","unlock","openbox","friend","castle","bannerConfig","main","battle","shareTemplates","infoButton","startShareInfo","module","exports","AF","wxHelper","init","isWxPhone","isVideoAdOpen","lastShareEventId","userInfo","openId","getStorage","nickName","avatarUrl","initShareData","loadAllVideoAds","wx","showShareMenu","withShareTicket","onShareAppMessage","title","imageUrl","query","shareData","id","status","time","onShow","res","now","Date","getTime","console","log","type","data","setShareInfo","onHide","getShareInfo","shareInfo","getShareStatus","eventId","key","getStorageSync","setStorage","value","setStorageSync","setClipboardData","str","shareAppMessage","scene","createBannerAd","tag","bannerAd","systemInfo","platform","getSystemInfo","w","cc","winSize","width","isHairScreen","Math","floor","style","left","top","windowHeight","windowWidth","show","onResize","hideBannerAd","destroy","moveBannerAd","y","height","getBannerAdHeight","showInfoButton","cb","createUserInfoButton","text","lineHeight","backgroundColor","color","textAlign","fontSize","borderRadius","onTap","hideInfoButton","createVideoAd","obj","videoAd","createRewardedVideoAd","adLoaded","onLoad","onError","load","showVideoAd","onFinish","isVideoAdLoaded","audio","onGameEnterBackground","onClose","onGameEnterForeground","isEnded","offClose","request","result","url","success","statusCode","fail","complete","getUserInfo","login","onLoginSucc","code","error","err","errMsg","onLoginFail","timeout","upScore","setUserCloudStorage","KVDataList","JSON","stringify","postMessage","cmd","getOpenDataContext","window","undefined"],"mappings":"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","file":"af-wx-helper.js","sourceRoot":"../../../../../assets/framework/platform","sourcesContent":["\r\n\"use strict\";\r\n\r\nvar self;\r\n\r\nvar videoConfig = {\r\n    power: {\r\n        adUnitId: 'adunit-b8725e85334ae519'\r\n    },\r\n    unlock: {\r\n        adUnitId: 'adunit-591765348646c1a1'\r\n    },\r\n    openbox: {\r\n        adUnitId: 'adunit-35001cd5627726da'\r\n    },\r\n    friend: {\r\n        adUnitId: 'adunit-d3b7efcbbc23a0bb'\r\n    },\r\n    castle: {\r\n        adUnitId: 'adunit-feb26727984a74e3'\r\n    },\r\n};\r\n\r\nvar bannerConfig = {\r\n    main: {\r\n        adUnitId: 'adunit-01e7fa530d116c13'\r\n    },\r\n    battle: {\r\n        adUnitId: 'adunit-51e4a64bbcb539f8'\r\n    },\r\n};\r\n\r\nvar shareTemplates;\r\n\r\nvar infoButton;\r\n\r\nvar startShareInfo = {}\r\n\r\nself = module.exports = AF.wxHelper = {\r\n\r\n    init: function (isWxPhone, isVideoAdOpen) {\r\n\r\n        self.lastShareEventId = 0;\r\n\r\n        self.userInfo = {\r\n            openId: self.getStorage('wxOpenId'),\r\n            nickName: self.getStorage('wxNickName') || '要上天啦你',\r\n            avatarUrl: self.getStorage('wxAvatarUrl') || '',\r\n            // avatarUrl: self.getStorage('avatarUrl') || 'https://res.pixel08.com/robot/10000.jpg',\r\n        };\r\n\r\n        // self.shareInfo = startShareInfo\r\n\r\n\r\n        self.initShareData();\r\n\r\n\r\n        if (isWxPhone && isVideoAdOpen) {\r\n            self.loadAllVideoAds();\r\n        }\r\n\r\n        wx.showShareMenu({\r\n            withShareTicket: true,\r\n        });\r\n\r\n        wx.onShareAppMessage(() => {\r\n            return {\r\n                title: \"要上天啦你\",\r\n                imageUrl: \"http://manager.pixel08.com/api/public/uploads/c8bc86484b28748830bf1a30b43385951534220948325.jpg\",\r\n                query: \"\"\r\n            };\r\n        });\r\n    },\r\n\r\n    initShareData: function () {\r\n        self.shareData = {\r\n            id: 0,\r\n            status: 0,\r\n            time: 0\r\n        };\r\n    },\r\n\r\n    onShow: function (res) {\r\n        if (self.shareData && self.shareData.id > 0) {\r\n            if (self.shareData.status != 0) {\r\n                self.initShareData();\r\n            } else {\r\n                var now = new Date().getTime();\r\n                if (now >= self.shareData.time + 3000) {\r\n                    self.shareData.status = 1;\r\n                } else {\r\n                    self.shareData.status = 2;\r\n                }\r\n            }\r\n        }\r\n        console.log('微信onshowwwwwwww',res.query['type'],res.query['data'])\r\n        var type = res.query['type'];\r\n        var data = res.query['data'];\r\n        self.setShareInfo(type, data);\r\n        // res.scene && (self.shareInfo.scene = res.scene);\r\n        // res.shareTicket && (self.shareInfo.scene = res.shareTicket);\r\n        // res.query['sharerOpenId'] && (self.shareInfo.sharerOpenId = res.query['sharerOpenId']);\r\n        // res.query['sharerNickName'] && (self.shareInfo.sharerNickName = res.query['sharerNickName']);\r\n        // res.query['sharerAvatarUrl'] && (self.shareInfo.sharerAvatarUrl = res.query['sharerAvatarUrl']);\r\n        // res.query['score'] && (self.shareInfo.score = res.query['score']);\r\n        // console.warn('分享者信息', self.shareInfo);\r\n    },\r\n\r\n    onHide: function (res) {\r\n\r\n    },\r\n\r\n    getShareInfo: function () {\r\n        return self.shareInfo;\r\n    },\r\n\r\n    setShareInfo: function (type, data) {\r\n        console.log('设置分享内容', type, data)\r\n\r\n        self.shareInfo = {};\r\n        if (type && data) {\r\n            console.log('设置分享内容', type, data)\r\n\r\n            self.shareInfo[type] = data;\r\n        }\r\n    },\r\n\r\n    getShareStatus: function (eventId) {\r\n        if (eventId != self.shareData.id) {\r\n            return -1;\r\n        }\r\n\r\n        return self.shareData.status;\r\n    },\r\n\r\n    getStorage: function (key) {\r\n        return wx.getStorageSync(key);\r\n    },\r\n\r\n    setStorage: function (key, value) {\r\n        wx.setStorageSync(key, value);\r\n    },\r\n\r\n    setClipboardData: function (str) {\r\n        wx.setClipboardData({ data: str });\r\n    },\r\n\r\n    shareAppMessage: function (scene, query) {\r\n\r\n        self.initShareData();\r\n\r\n        /*\r\n        if (!shareTemplates) {\r\n            onFail();\r\n            return;\r\n        }\r\n\r\n        if (!shareTemplates[scene]) {\r\n            onFail();\r\n            return;\r\n        }\r\n\r\n        var len = shareTemplates[scene].length;\r\n\r\n        if (len <= 0) {\r\n            onFail();\r\n            return;\r\n        }\r\n\r\n        var idx = 0;\r\n\r\n        if (len > 1) {\r\n            idx = Math.floor(len * Math.random());\r\n        }\r\n        */\r\n\r\n        self.lastShareEventId++;\r\n        self.shareData.id = self.lastShareEventId;\r\n        self.shareData.status = 0;\r\n        self.shareData.time = new Date().getTime();\r\n\r\n        wx.shareAppMessage({\r\n            title: \"哈哈哈\",\r\n            imageUrl: \"http://manager.pixel08.com/api/public/uploads/c8bc86484b28748830bf1a30b43385951534220948325.jpg\",\r\n            query: query\r\n        });\r\n\r\n        return self.shareData.id;\r\n    },\r\n\r\n    createBannerAd: function (tag) {\r\n        if (!bannerConfig[tag]) {\r\n            return false;\r\n        }\r\n\r\n        if (bannerConfig[tag].bannerAd) {\r\n            return true;\r\n        }\r\n\r\n        var systemInfo = AF.platform.getSystemInfo();\r\n\r\n        var w = cc.winSize.width;\r\n\r\n        if (AF.platform.isHairScreen()) {\r\n            w = Math.floor(cc.winSize.width * 0.6);\r\n        }\r\n\r\n        var width = w / cc.winSize.width;\r\n\r\n        bannerConfig[tag].bannerAd = wx.createBannerAd({\r\n            adUnitId: bannerConfig[tag].adUnitId,\r\n            style: {\r\n                left: 0,\r\n                top: systemInfo.windowHeight,\r\n                width: Math.floor(width * systemInfo.windowWidth)\r\n            }\r\n        });\r\n\r\n        bannerConfig[tag].bannerAd.show();\r\n        bannerConfig[tag].res = null;\r\n\r\n        bannerConfig[tag].bannerAd.onResize(res => {\r\n            bannerConfig[tag].res = res;\r\n            bannerConfig[tag].bannerAd.style.left = Math.floor((systemInfo.windowWidth - res.width) / 2);\r\n        });\r\n\r\n        return true;\r\n    },\r\n\r\n    hideBannerAd: function (tag) {\r\n        if (!bannerConfig[tag]) {\r\n            return;\r\n        }\r\n\r\n        if (bannerConfig[tag].bannerAd) {\r\n            bannerConfig[tag].bannerAd.destroy();\r\n            bannerConfig[tag].bannerAd = null;\r\n            bannerConfig[tag].res = null;\r\n        }\r\n    },\r\n\r\n    moveBannerAd: function (tag, y) {\r\n        if (!bannerConfig[tag]) {\r\n            return;\r\n        }\r\n\r\n        var systemInfo = AF.platform.getSystemInfo();\r\n\r\n        var top = (cc.winSize.height - y) / cc.winSize.height;\r\n\r\n        if (bannerConfig[tag].bannerAd) {\r\n            bannerConfig[tag].bannerAd.style.top = Math.floor(top * systemInfo.windowHeight);\r\n        }\r\n    },\r\n    getBannerAdHeight: function (tag) {\r\n        if (!bannerConfig[tag]) {\r\n            return 0;\r\n        }\r\n\r\n        if (!bannerConfig[tag].bannerAd) {\r\n            return 0;\r\n        }\r\n\r\n        if (!bannerConfig[tag].res) {\r\n            return 0;\r\n        }\r\n\r\n        var systemInfo = AF.platform.getSystemInfo();\r\n\r\n        var height = Math.floor((bannerConfig[tag].res.height / systemInfo.windowHeight) * cc.winSize.height);\r\n\r\n        if (AF.platform.isHairScreen()) {\r\n            height += 40;\r\n        }\r\n\r\n        return height;\r\n    },\r\n    showInfoButton: function (left, top, width, height, cb) {\r\n\r\n        console.log(\"showInfoButton\", left, top, width, height);\r\n\r\n        if (infoButton) {\r\n            return;\r\n        }\r\n\r\n        var systemInfo = AF.platform.getSystemInfo();\r\n        infoButton = wx.createUserInfoButton({\r\n            type: 'text',\r\n            text: '',\r\n            style: {\r\n                left: left,\r\n                top: top,\r\n                width: width,\r\n                height: height,\r\n                lineHeight: 40,\r\n                backgroundColor: '#ff000000',\r\n                color: '#ffffff',\r\n                textAlign: 'center',\r\n                fontSize: 16,\r\n                borderRadius: 4\r\n            }\r\n        });\r\n\r\n        if (!infoButton) {\r\n            return;\r\n        }\r\n\r\n        infoButton.onTap((res) => {\r\n            if (res.userInfo) {\r\n                self.userInfo.nickName = res.userInfo.nickName;\r\n                self.userInfo.avatarUrl = res.userInfo.avatarUrl;\r\n\r\n                self.setStorage('wxNickName', self.userInfo.nickName);\r\n                self.setStorage('wxAvatarUrl', self.userInfo.avatarUrl);\r\n                cb && cb(self.userInfo);\r\n            }\r\n        });\r\n\r\n    },\r\n    hideInfoButton: function () {\r\n        if (infoButton) {\r\n            infoButton.destroy()\r\n            infoButton = null;\r\n        }\r\n    },\r\n\r\n    loadAllVideoAds: function () {\r\n        for (let tag in videoConfig) {\r\n            self.createVideoAd(tag);\r\n        }\r\n    },\r\n\r\n    createVideoAd: function (tag) {\r\n        var obj = videoConfig[tag];\r\n\r\n        if (obj.videoAd) {\r\n            return;\r\n        }\r\n\r\n        obj.videoAd = wx.createRewardedVideoAd({\r\n            adUnitId: obj.adUnitId\r\n        });\r\n\r\n        obj.adLoaded = false;\r\n\r\n        obj.videoAd.onLoad(() => {\r\n            obj.adLoaded = true;\r\n            console.log('激励视频 广告加载成功');\r\n        });\r\n\r\n        obj.videoAd.onError(err => {\r\n            console.log('激励视频 广告加载失败，重新加载');\r\n            obj.videoAd.load();\r\n        });\r\n    },\r\n\r\n    showVideoAd: function (tag, onFinish) {\r\n        if (!self.isVideoAdLoaded(tag)) {\r\n            return;\r\n        }\r\n\r\n        // 关闭声音\r\n        AF.audio.onGameEnterBackground();\r\n\r\n        var obj = videoConfig[tag];\r\n\r\n        obj.videoAd.onClose(res => {\r\n            // 用户点击了【关闭广告】按钮\r\n\r\n            // 开启声音\r\n            AF.audio.onGameEnterForeground();\r\n\r\n            // 小于 2.1.0 的基础库版本，res 是一个 undefined\r\n            if (!res || res.isEnded) {\r\n                // 正常播放结束，可以下发游戏奖励\r\n                onFinish(true);\r\n            }\r\n            else {\r\n                // 播放中途退出，不下发游戏奖励\r\n                onFinish(false);\r\n            }\r\n\r\n            obj.videoAd.offClose();\r\n            obj.videoAd.load();\r\n        });\r\n\r\n        obj.adLoaded = false;\r\n        obj.videoAd.show();\r\n    },\r\n\r\n    isVideoAdLoaded: function (tag) {\r\n        if (!videoConfig[tag]) {\r\n            return false;\r\n        }\r\n\r\n        return (videoConfig[tag].adLoaded === true);\r\n    },\r\n\r\n    request: function (obj) {\r\n        var result;\r\n        var status;\r\n\r\n        wx.request({\r\n            url: obj.url,\r\n            data: obj.data,\r\n            success: (res) => {\r\n                status = res.statusCode;\r\n                result = res.data;\r\n            },\r\n            fail: (res) => {\r\n                status = res.statusCode;\r\n                result = res.data;\r\n            },\r\n            complete: () => {\r\n                if (result && status == 200) {\r\n                    obj.success && obj.success({ data: result, statusCode: status });\r\n                } else {\r\n                    obj.fail && obj.fail({ data: result, statusCode: status });\r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n    getUserInfo: function () {\r\n        return self.userInfo;\r\n    },\r\n\r\n    login: function (success, fail, complete) {\r\n        var onLoginSucc = function (res) {\r\n            if (res.code) {\r\n                success && success(res.code);\r\n                // success(self.guid());\r\n                // var wxcode = res.code;\r\n                // var authUrl = `https://api.weixin.qq.com/sns/jscode2session?appid=${config['wx.appId']}&secret=${config['wx.secret']}&js_code=${wxcode}&grant_type=authorization_code`;\r\n                // // 发起网络请求\r\n                // wx.request({\r\n                //     url: authUrl,\r\n                //     data: null,\r\n                //     success: (res) => {\r\n                //         console.error('获取 openid 成功' + res);\r\n                //         var openid = res.data.openid;\r\n                //         wx.setStorageSync('openId', openid);\r\n                //         success && success(openid);\r\n                //     },\r\n                //     fail: (err) => {\r\n                //         console.error('获取 openid 失败' + err);\r\n                //         fail && fail('获取 openid 失败');\r\n                //     },\r\n                //     complete: complete,\r\n                // });\r\n            } else {\r\n                console.error('登录失败' + err.errMsg);\r\n                fail && fail('登录失败');\r\n            }\r\n        }\r\n\r\n        var onLoginFail = function (err) {\r\n            console.error('登录失败', err.errMsg);\r\n            fail && fail('登录失败');\r\n        }\r\n\r\n        wx.login({\r\n            timeout: 10000,\r\n            success: onLoginSucc,\r\n            fail: onLoginFail,\r\n            complete: complete,\r\n        });\r\n    },\r\n\r\n    upScore: function (data) {\r\n        wx.setUserCloudStorage({\r\n            KVDataList: [{ key: \"score\", value: JSON.stringify(data) }]\r\n        });\r\n    },\r\n\r\n    postMessage: function (cmd, data) {\r\n        wx.getOpenDataContext().postMessage({\r\n            cmd: cmd,\r\n            data: data\r\n        });\r\n    },\r\n};\r\n\r\nif(window.wx !== undefined){\r\n    wx.onShow(res => {\r\n        self.onShow(res);\r\n    });\r\n    \r\n    wx.onHide(res => {\r\n        self.onHide(res);\r\n    });\r\n    \r\n}"]}