{"version":3,"sources":["../../../../../assets/framework/utils/assets/framework/utils/af-netsprite.js"],"names":["loadResourcesFile","url","Promise","resolve","rejec","cc","loader","load","err","res","NetSpriteloader","init","allNeedLoadFiles","Array","currLoadFileInfo","loadingFiles","startLoadNetSprite","filename","name","processLoadFile","getUrl","AF","platform","isWxApp","isQQApp","util","getLocalFilePath","isLocalFileExist","getRemoteUrl","pictureUrl","self","then","spriteFrame","SpriteFrame","emitLoadEnded","succ","EventDispatcher","emit","Event","FILE_LOADNETSPRITE","module","exports"],"mappings":";;;;;;AAAA;;;;AAIA,SAASA,iBAAT,CAA2BC,GAA3B,EAAgC;AAC5B,WAAO,IAAIC,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,KAAnB,EAA0B;AACzCC,WAAGC,MAAH,CAAUC,IAAV,CAAeN,GAAf,EAAoB,UAAUO,GAAV,EAAeC,GAAf,EAAoB;AACpC,gBAAID,GAAJ,EAAS;AACLJ,sBAAMI,GAAN;AACA;AACH;AACDL,oBAAQM,GAAR;AACH,SAND;AAOH,KARM,CAAP;AASH;;AAGD,IAAIC,kBAAkB;AAClBC,UAAM,gBAAY;AACd,aAAKC,gBAAL,GAAwB,IAAIC,KAAJ,EAAxB;AACA,aAAKC,gBAAL,GAAwB,IAAxB;AACA,aAAKC,YAAL,GAAoB,EAApB;AACH,KALiB;;AAOlBC,wBAAoB,4BAAUC,QAAV,EAAoB;;AAEpC,YAAI,KAAKF,YAAL,CAAkBE,QAAlB,CAAJ,EAAiC;AAAE;AAAS;;AAE5C,aAAKF,YAAL,CAAkBE,QAAlB,IAA8B,EAAEC,MAAMD,QAAR,EAA9B;AACA,aAAKE,eAAL,CAAqBF,QAArB;AACH,KAbiB;;AAelBG,YAAQ,gBAAUH,QAAV,EAAoB;AACxB,YAAIhB,MAAM,EAAV;AACA,YAAIoB,GAAGC,QAAH,CAAYC,OAAZ,MAAyBF,GAAGC,QAAH,CAAYE,OAAZ,EAA7B,EAAoD;AAChDvB,kBAAMoB,GAAGI,IAAH,CAAQC,gBAAR,CAAyBT,QAAzB,CAAN;;AAEA,gBAAI,CAACI,GAAGI,IAAH,CAAQE,gBAAR,CAAyBV,QAAzB,CAAL,EAAyC;AACrChB,sBAAMoB,GAAGI,IAAH,CAAQG,YAAR,CAAqBX,QAArB,CAAN;AACH;AACJ,SAND,MAOK;AACDhB,kBAAMoB,GAAGI,IAAH,CAAQG,YAAR,CAAqBX,QAArB,CAAN;AACH;AACD,eAAOhB,GAAP;AACH,KA5BiB;;AA8BlBkB,qBAAiB,yBAAUF,QAAV,EAAoB;;AAEjC,YAAIY,aAAa,KAAKT,MAAL,CAAYH,QAAZ,CAAjB;AACA,YAAIa,OAAO,IAAX;AACA9B,0BAAkB6B,UAAlB,EAA8BE,IAA9B,CAAmC,UAACtB,GAAD,EAAS;AACxC,gBAAIuB,cAAc,IAAI3B,GAAG4B,WAAP,CAAmBxB,GAAnB,CAAlB;AACAqB,iBAAKI,aAAL,CAAmBjB,QAAnB,EAA6Be,WAA7B,EAA0C,IAA1C;AACH,SAHD,EAGG,UAACxB,GAAD,EAAS;AACRsB,iBAAKI,aAAL,CAAmBjB,QAAnB,EAA6B,IAA7B,EAAmC,KAAnC;AAEH,SAND;AAOH,KAzCiB;;AA2ClBiB,mBAAe,uBAAUjB,QAAV,EAAoBe,WAApB,EAAiCG,IAAjC,EAAuC;AAClD,aAAKpB,YAAL,CAAkBE,QAAlB,IAA8B,IAA9B;AACAI,WAAGe,eAAH,CAAmBC,IAAnB,CAAwBhB,GAAGiB,KAAH,CAASC,kBAAjC,EAAqDtB,QAArD,EAA+De,WAA/D,EAA4EG,IAA5E;AACH;;AA9CiB,CAAtB;;AAkDAzB,gBAAgBC,IAAhB;;AAEAU,GAAGX,eAAH,GAAqB8B,OAAOC,OAAP,GAAiB/B,eAAtC","file":"af-netsprite.js","sourceRoot":"../../../../../assets/framework/utils","sourcesContent":["/**\r\n * 单张图片加载管理函数\r\n */\r\n\r\nfunction loadResourcesFile(url) {\r\n    return new Promise(function (resolve, rejec) {\r\n        cc.loader.load(url, function (err, res) {\r\n            if (err) {\r\n                rejec(err);\r\n                return;\r\n            }\r\n            resolve(res);\r\n        });\r\n    });\r\n}\r\n\r\n\r\nvar NetSpriteloader = {\r\n    init: function () {\r\n        this.allNeedLoadFiles = new Array();\r\n        this.currLoadFileInfo = null;\r\n        this.loadingFiles = {};\r\n    },\r\n\r\n    startLoadNetSprite: function (filename) {\r\n\r\n        if (this.loadingFiles[filename]) { return; }\r\n\r\n        this.loadingFiles[filename] = { name: filename };\r\n        this.processLoadFile(filename);\r\n    },\r\n\r\n    getUrl: function (filename) {\r\n        var url = '';\r\n        if (AF.platform.isWxApp() || AF.platform.isQQApp()) {\r\n            url = AF.util.getLocalFilePath(filename);\r\n\r\n            if (!AF.util.isLocalFileExist(filename)) {\r\n                url = AF.util.getRemoteUrl(filename);\r\n            }\r\n        }\r\n        else {\r\n            url = AF.util.getRemoteUrl(filename);\r\n        }\r\n        return url;\r\n    },\r\n\r\n    processLoadFile: function (filename) {\r\n\r\n        var pictureUrl = this.getUrl(filename);\r\n        var self = this;\r\n        loadResourcesFile(pictureUrl).then((res) => {\r\n            var spriteFrame = new cc.SpriteFrame(res);\r\n            self.emitLoadEnded(filename, spriteFrame, true);\r\n        }, (err) => {\r\n            self.emitLoadEnded(filename, null, false);\r\n\r\n        });\r\n    },\r\n\r\n    emitLoadEnded: function (filename, spriteFrame, succ) {\r\n        this.loadingFiles[filename] = null;\r\n        AF.EventDispatcher.emit(AF.Event.FILE_LOADNETSPRITE, filename, spriteFrame, succ);\r\n    },\r\n\r\n};\r\n\r\nNetSpriteloader.init();\r\n\r\nAF.NetSpriteloader = module.exports = NetSpriteloader;\r\n"]}