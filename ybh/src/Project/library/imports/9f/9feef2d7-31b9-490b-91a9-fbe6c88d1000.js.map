{"version":3,"sources":["../../../../../assets/framework/misc/assets/framework/misc/af-app-launcher.js"],"names":["ua","isAndroid","isChrome","cc","sys","isNative","navigator","userAgent","win","window","match","AppLauncher","Const","LAUNCHE_TIMEOUT","loadIframe","getIntentIframe","iframe","document","createElement","style","cssText","body","appendChild","getChromeIntent","appInfo","scheme","AndroidSchemeURL","iOSSchemeURL","AndroidPackageName","openApp","location","href","src","redirectToDownloadUrl","AndroidDownloadURL","iOSDownloadURL","open","t","Date","now","setTimeout","timeout","module","exports","AF"],"mappings":";;;;;;AAAA;;;;AAIA,IAAIA,EAAJ,EAAQC,SAAR,EAAmBC,QAAnB;;AAEA,IAAI,CAACC,GAAGC,GAAH,CAAOC,QAAZ,EAAsB;AAClBL,SAAKM,UAAUC,SAAf;AACA,QAAIC,MAAMC,MAAV;AACAP,eAAYF,GAAGU,KAAH,CAAS,kBAAT,KAAgCV,GAAGU,KAAH,CAAS,iBAAT,CAA5C;AACAT,gBAAYD,GAAGU,KAAH,CAAS,6BAAT,CAAZ;AACH;;AAED,IAAIC,cAAc,EAAlB;;AAEAA,YAAYC,KAAZ,GAAoB;AAChBC,qBAAiB,GADD,CACQ;AADR,CAApB;;AAIA,IAAIC,UAAJ;AACA,SAASC,eAAT,GAA2B;AACvB,QAAG,CAACD,UAAJ,EAAe;AACX,YAAIE,SAASC,SAASC,aAAT,CAAuB,QAAvB,CAAb;AACAF,eAAOG,KAAP,CAAaC,OAAb,GAAuB,oCAAvB;AACAH,iBAASI,IAAT,CAAcC,WAAd,CAA0BN,MAA1B;AACAF,qBAAaE,MAAb;AACH;AACD,WAAOF,UAAP;AACH;;AAED,SAASS,eAAT,CAAyBC,OAAzB,EAAkC;AAC9B,QAAIC,SAASxB,YAAYuB,QAAQE,gBAApB,GAAuCF,QAAQG,YAA5D;AACA;AACA,WAAQ,sCAAsCF,MAAtC,GAA+C,WAA/C,GAA6DD,QAAQI,kBAArE,GAA0F,MAAlG;AACH;;AAED,SAASC,OAAT,CAAiBL,OAAjB,EAA0B;AACtB,QAAIC,SAASxB,YAAYuB,QAAQE,gBAApB,GAAuCF,QAAQG,YAA5D;AACA,QAAG,CAACzB,QAAJ,EAAc;AACV,YAAGD,SAAH,EAAa;AACTO,gBAAIsB,QAAJ,CAAaC,IAAb,GAAoBR,gBAAgBC,OAAhB,CAApB;AACH,SAFD,MAEK;AACDhB,gBAAIsB,QAAJ,CAAaC,IAAb,GAAoBN,MAApB;AACH;AACJ,KAND,MAMO;AACHV,0BAAkBiB,GAAlB,GAAwBP,MAAxB;AACH;AACJ;;AAED;;;;AAIA,SAASQ,qBAAT,CAA+BT,OAA/B,EAAuC;AACnChB,QAAIsB,QAAJ,CAAaC,IAAb,GAAoB9B,YAAYuB,QAAQU,kBAApB,GAAyCV,QAAQW,cAArE;AACH;;AAGD;;;;;;;;;;;AAWAxB,YAAYyB,IAAZ,GAAmB,UAASZ,OAAT,EAAiB;AAChC,QAAIa,IAAIC,KAAKC,GAAL,EAAR;AACAV,YAAQL,OAAR;AACAgB,eAAW,YAAU;AACjB,YAAGF,KAAKC,GAAL,KAAaF,CAAb,GAAiB1B,YAAYC,KAAZ,CAAkBC,eAAlB,GAAoC,GAAxD,EAA4D;AACxDoB,kCAAsBT,OAAtB;AACH;AACJ,KAJD,EAIG,KAAKiB,OAJR;AAKH,CARD;;AAUAC,OAAOC,OAAP,GAAiB,CAAClC,OAAOmC,EAAP,GAAYnC,OAAOmC,EAAP,IAAa,EAA1B,EAA8BjC,WAA9B,GAA4CA,WAA7D","file":"af-app-launcher.js","sourceRoot":"../../../../../assets/framework/misc","sourcesContent":["/**\r\n * App启动器\r\n */\r\n\r\nvar ua, isAndroid, isChrome;\r\n\r\nif (!cc.sys.isNative) {\r\n    ua = navigator.userAgent;\r\n    var win = window;\r\n    isChrome  = ua.match(/Chrome\\/([\\d.]+)/) || ua.match(/CriOS\\/([\\d.]+)/);\r\n    isAndroid = ua.match(/(Android);?[\\s\\/]+([\\d.]+)?/);\r\n}\r\n\r\nvar AppLauncher = {};\r\n\r\nAppLauncher.Const = {\r\n    LAUNCHE_TIMEOUT: 500,   // 跳转超时\r\n};\r\n\r\nvar loadIframe;\r\nfunction getIntentIframe() {\r\n    if(!loadIframe){\r\n        var iframe = document.createElement(\"iframe\");\r\n        iframe.style.cssText = \"display:none;width:0px;height:0px;\";\r\n        document.body.appendChild(iframe);\r\n        loadIframe = iframe;\r\n    }\r\n    return loadIframe;\r\n}\r\n\r\nfunction getChromeIntent(appInfo) {\r\n    var scheme = isAndroid ? appInfo.AndroidSchemeURL : appInfo.iOSSchemeURL;\r\n    // 此处域名产品修改\r\n    return  \"intent://t.qq.com/#Intent;scheme=\" + scheme + \";package=\" + appInfo.AndroidPackageName + \";end\";\r\n}\r\n\r\nfunction openApp(appInfo) {\r\n    var scheme = isAndroid ? appInfo.AndroidSchemeURL : appInfo.iOSSchemeURL;\r\n    if(!isChrome) {\r\n        if(isAndroid){\r\n            win.location.href = getChromeIntent(appInfo);\r\n        }else{\r\n            win.location.href = scheme;\r\n        }\r\n    } else {\r\n        getIntentIframe().src = scheme;\r\n    }\r\n}\r\n\r\n/**\r\n * iOS 6.0以上用这种方式跳转appstore\r\n * <meta name=\"apple-itunes-app\" content=\"app-id=432274380\">\r\n */\r\nfunction redirectToDownloadUrl(appInfo){\r\n    win.location.href = isAndroid ? appInfo.AndroidDownloadURL : appInfo.iOSDownloadURL;\r\n}\r\n\r\n\r\n/**\r\n * 打开应用失败则跳转到应用下载页面\r\n * @param appInfo\r\n *\r\n * appInfo字段说明:\r\n *  - AndroidPackageName   安卓包名\r\n *  - AndroidSchemeURL     安卓scheme链接\r\n *  - AndroidDownloadURL   安卓下载页面\r\n *  - iOSSchemeURL         iOS scheme链接\r\n *  - iOSDownloadURL       iOS下载链接\r\n */\r\nAppLauncher.open = function(appInfo){\r\n    var t = Date.now();\r\n    openApp(appInfo);\r\n    setTimeout(function(){\r\n        if(Date.now() - t < AppLauncher.Const.LAUNCHE_TIMEOUT + 100){\r\n            redirectToDownloadUrl(appInfo);\r\n        }\r\n    }, this.timeout)\r\n};\r\n\r\nmodule.exports = (window.AF = window.AF || {}).AppLauncher = AppLauncher;\r\n\r\n\r\n"]}