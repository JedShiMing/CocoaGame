{"version":3,"sources":["../../../../../../assets/framework/ui/base/assets/framework/ui/base/AFDialogBase.js"],"names":["SceneMgr","require","IN_OUT_ACTION_TAG","window","AF","DialogBase","cc","Class","extends","Component","properties","enableInOutAction","default","displayName","inOutActionTag","visible","enableTouchEmptyPlaceToClose","isSceneDialog","tooltip","noHideOtherDialog","noHideBelowDialog","enableDialogPopOutAudioEffect","dialogPopOutAudioEffect","type","AudioClip","onLoad","uiSceneTouchEnable","listenEvents","name","node","instance","registerDialog","active","_isClosing","addMask","EventDispatcher","on","Event","WILL_OPEN_DIALOG","willOpenDialog","UI_SCENE_TOUCH_ENABLE","setUISceneTouchEnable","onEnable","runInAction","_mask","onTouchEmptyPlace","audio","playDialogPopOutEffect","onDisable","off","onDestroy","unregAllEvents","unregisterDialog","regEvent","eventType","callback","i","length","event","push","unregEvent","splice","_getCanvasNode","scene","director","getScene","canvas","getChildByName","children","len","log","getComponent","Canvas","zIndex","winSize","mask","Node","width","height","addChild","touch","panel","pt","convertTouchToNodeSpace","sz","getContentSize","rect","rectContainsPoint","close","_getRootNode","root","parent","runOutAction","onDialogClosed","bind","closeImmediate","isClosing","emit","stopActionByTag","center","p","convertToNodeSpace","setPosition","scale","opacity","act","spawn","scaleTo","easing","easeBackOut","fadeTo","seq","sequence","callFunc","setTag","runAction","onComplete","moveBy"],"mappings":"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","file":"AFDialogBase.js","sourceRoot":"../../../../../../assets/framework/ui/base","sourcesContent":["var SceneMgr = require('af-scene-mgr');\r\n\r\nvar IN_OUT_ACTION_TAG = 1298;\r\n\r\n(window.AF = window.AF || {}).DialogBase = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        enableInOutAction: {\r\n            default: false,\r\n            displayName: \"启用弹出/关闭效果\"\r\n        },\r\n        // 弹窗/关闭效果的 action tag\r\n        inOutActionTag: {\r\n            default: 1298,\r\n            visible: false\r\n        },\r\n\r\n        enableTouchEmptyPlaceToClose: {\r\n            default: false,\r\n            displayName: \"点击空白处关闭\"\r\n        },\r\n\r\n        // maskColor: {\r\n        //     default: cc.color(155, 0, 0),\r\n        //     displayName: \"蒙板颜色\",\r\n        // },\r\n\r\n        // hideDialog: CC_EDITOR && {\r\n        //     type: cc.Boolean,\r\n        //     displayName: \"隐藏(编辑器中)\",\r\n        //     set: function(value) {\r\n        //         this._hideDialog = value;\r\n        //         this.node.opacity = 0;\r\n        //     },\r\n        //     get: function () {\r\n        //         return !!this._hideDialog;\r\n        //     },\r\n        // },\r\n\r\n        isSceneDialog: {\r\n            default: false,\r\n            displayName: \"场景对话框\",\r\n            tooltip: \"是否是挂在场景上边的对话框\"\r\n        },\r\n\r\n        noHideOtherDialog: {\r\n            default: false,\r\n            displayName: \"不隐藏其他对话框\",\r\n            tooltip: \"打开本对话框时不隐藏之前打开的对话框\"\r\n        },\r\n\r\n        noHideBelowDialog: {\r\n            default: false,\r\n            displayName: \"始终显示\",\r\n            tooltip: \"在打开其它对话框时不隐藏本对话框\"\r\n        },\r\n\r\n        enableDialogPopOutAudioEffect: {\r\n            default: false,\r\n            displayName: '开启弹出音效'\r\n        },\r\n        dialogPopOutAudioEffect: {\r\n            type: cc.AudioClip,\r\n            default: null,\r\n            displayName: '弹出音效'\r\n        }\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this.uiSceneTouchEnable = false;\r\n\r\n        this.listenEvents = [];\r\n\r\n        // 注册场景对话框\r\n        if (this.isSceneDialog) {\r\n            var name = this.node.name;\r\n            SceneMgr.instance.registerDialog(name, this.node);\r\n            this.node.active = true;\r\n            // this.node.opacity = 255;\r\n        }\r\n\r\n        this._isClosing = false;\r\n\r\n        // 给对话框填一个mask\r\n        this.addMask();\r\n\r\n        AF.EventDispatcher.on(AF.Event.WILL_OPEN_DIALOG, this.willOpenDialog, this);\r\n        AF.EventDispatcher.on(AF.Event.UI_SCENE_TOUCH_ENABLE, this.setUISceneTouchEnable, this);\r\n\r\n    },\r\n\r\n    onEnable: function () {\r\n        this.runInAction();\r\n        // this.enableInOutAction && this.runInAction();\r\n        // 监听点击事件\r\n        this._mask.on('touchstart', this.onTouchEmptyPlace, this);\r\n\r\n        // 弹出音效\r\n        if (this.enableDialogPopOutAudioEffect) {\r\n            AF.audio.playDialogPopOutEffect();\r\n        }\r\n    },\r\n\r\n    onDisable: function () {\r\n        this._mask.off('touchstart', this.onTouchEmptyPlace, this);\r\n    },\r\n\r\n    onDestroy: function () {\r\n\r\n        AF.EventDispatcher.off(AF.Event.WILL_OPEN_DIALOG, this.willOpenDialog);\r\n        AF.EventDispatcher.off(AF.Event.UI_SCENE_TOUCH_ENABLE, this.setUISceneTouchEnable);\r\n        this.unregAllEvents();\r\n\r\n        // 注册场景对话框\r\n        if (this.isSceneDialog) {\r\n            var name = this.node.name;\r\n            SceneMgr.instance.unregisterDialog(name, this.node);\r\n        }\r\n    },\r\n\r\n    regEvent: function (eventType, callback) {\r\n        for (let i = 0; i < this.listenEvents.length; i++) {\r\n            var event = this.listenEvents[i];\r\n            if (event.type === eventType) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        this.listenEvents.push({ type: eventType, callback: callback });\r\n        AF.EventDispatcher.on(eventType, callback, this);\r\n    },\r\n\r\n    unregEvent: function (eventType) {\r\n        for (let i = 0; i < this.listenEvents.length; i++) {\r\n            var event = this.listenEvents[i];\r\n            if (event.type === eventType) {\r\n                AF.EventDispatcher.off(event.type, event.callback, this);\r\n                this.listenEvents.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    },\r\n\r\n    unregAllEvents: function () {\r\n        for (let i = 0; i < this.listenEvents.length; i++) {\r\n            var event = this.listenEvents[i];\r\n            AF.EventDispatcher.off(event.type, event.callback, this)\r\n        }\r\n\r\n        this.listenEvents = [];\r\n    },\r\n\r\n    _getCanvasNode: function () {\r\n        var scene = cc.director.getScene();\r\n        var canvas = scene.getChildByName(\"Canvas\");\r\n        if (canvas) return canvas;\r\n        var children = scene.children;\r\n        var len = children.length;\r\n        for (var i = 0; i < len; ++i) {\r\n            cc.log(\"Node: \" + children[i]);\r\n            if (children[i].getComponent(cc.Canvas)) {\r\n                return children[i];\r\n            }\r\n        }\r\n    },\r\n    // 给对话框填一个mask    \r\n    addMask: function () {\r\n        var children = this.node.children;\r\n        var len = children.length;\r\n        for (var i = 0; i < len; ++i) {\r\n            children[i].zIndex += 1;\r\n        }\r\n        var winSize = cc.winSize;\r\n        var mask = new cc.Node(\"DialogMask\");\r\n        mask.zIndex = 0;\r\n        mask.width = winSize.width;\r\n        mask.height = winSize.height;\r\n        // mask.color = this.maskColor;\r\n        this._mask = mask;\r\n        this.node.addChild(mask);\r\n    },\r\n\r\n    onTouchEmptyPlace: function (touch) {\r\n        if (!this.uiSceneTouchEnable) { return; }\r\n        if (!this.enableTouchEmptyPlaceToClose) { return; }\r\n        var panel = this.node.getChildByName(\"panel\");\r\n        if (!panel) {\r\n            panel = this.node;\r\n        }\r\n        var pt = panel.convertTouchToNodeSpace(touch);\r\n        var sz = panel.getContentSize();\r\n        var rect = cc.rect(0, 0, sz.width, sz.height);\r\n        if (!cc.rectContainsPoint(rect, pt)) {\r\n            this.close();\r\n        }\r\n        return true;\r\n    },\r\n\r\n    willOpenDialog: function () {\r\n        this.uiSceneTouchEnable = false;\r\n    },\r\n\r\n    setUISceneTouchEnable: function () {\r\n        this.uiSceneTouchEnable = true;\r\n    },\r\n\r\n    _getRootNode: function () {\r\n        if (this.isSceneDialog) return this.node;\r\n        var root = cc.director.getScene();\r\n        var node = this.node;\r\n        while (true) {\r\n            if (node.parent == root) {\r\n                return node;\r\n            } else {\r\n                node = node.parent;\r\n            }\r\n        }\r\n    },\r\n\r\n    close: function () {\r\n        this._isClosing = true;\r\n        this.runOutAction(function () {\r\n            this._isClosing = false;\r\n            var node = this._getRootNode();\r\n            SceneMgr.instance.onDialogClosed(node.name, node);\r\n        }.bind(this));\r\n    },\r\n    \r\n    closeImmediate: function () {\r\n        var node = this._getRootNode();\r\n        SceneMgr.instance.onDialogClosed(node.name, node);\r\n    },\r\n\r\n    isClosing: function () {\r\n        return this._isClosing = true;\r\n    },\r\n\r\n    // 窗口弹出动画action, 可以重载\r\n    runInAction: function () {\r\n        if (!this.enableInOutAction) {\r\n            AF.EventDispatcher.emit(AF.Event.UI_SCENE_TOUCH_ENABLE, true);\r\n            return;\r\n        }\r\n        var node = this.node;\r\n        node.stopActionByTag(this.inOutActionTag);\r\n        var center = cc.p(cc.winSize.width / 2, cc.winSize.height / 2);\r\n        center = this.node.parent.convertToNodeSpace(center);\r\n        node.setPosition(center);\r\n        node.scale = 0.6;\r\n        node.opacity = 0;\r\n        var act = cc.spawn(\r\n            cc.scaleTo(0.35, 1).easing(cc.easeBackOut()),\r\n            cc.fadeTo(0.35, 255)\r\n        );\r\n        var seq = cc.sequence(act, cc.callFunc(function () {\r\n            AF.EventDispatcher.emit(AF.Event.UI_SCENE_TOUCH_ENABLE, true);\r\n        }));\r\n        seq.setTag(this.inOutActionTag);\r\n        node.runAction(seq);\r\n    },\r\n    // 窗口隐藏动画,动画完成必须回调onComplete\r\n    runOutAction: function (onComplete) {\r\n        if (!this.enableInOutAction) {\r\n            onComplete && onComplete();\r\n            return;\r\n        }\r\n        var node = this.node;\r\n        node.stopActionByTag(this.inOutActionTag);\r\n        var act = cc.sequence(\r\n            cc.spawn(\r\n                cc.scaleTo(0.1, 0.6),\r\n                cc.fadeTo(0.1, 0.4),\r\n                cc.moveBy(0.1, cc.p(0, -50))\r\n            ),\r\n            cc.callFunc(onComplete)\r\n        );\r\n        act.setTag(this.inOutActionTag);\r\n        node.runAction(act);\r\n    },\r\n\r\n});"]}