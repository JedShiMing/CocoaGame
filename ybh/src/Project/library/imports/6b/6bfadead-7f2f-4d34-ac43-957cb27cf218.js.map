{"version":3,"sources":["../../../../../../assets/framework/ui/widget/assets/framework/ui/widget/AFDownloadLayer.js"],"names":["DialogBase","require","cc","Class","extends","editor","menu","properties","downloadProgress","default","type","ProgressBar","displayName","onLoad","prototype","call","downloadState","regEvent","AF","Event","FILE_DOWNLOAD","onFileDownloaded","onEnable","workState","currentState","currentIndex","fileList","DIALOG_PARAMS","progress","percent","onDestroy","show","isShow","panel","node","getChildByName","opacity","filename","url","state","length","downloadFile","Downloader","startDownloadFile","update","dt","close","EventDispatcher","emit","DOWNLOADDIAGLOG_ON_CLOSE"],"mappings":"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","file":"AFDownloadLayer.js","sourceRoot":"../../../../../../assets/framework/ui/widget","sourcesContent":["var DialogBase = require('AFDialogBase');\r\n\r\ncc.Class({\r\n    extends: DialogBase,\r\n\r\n    editor: {\r\n        menu: 'ApplicationFramework/AFDownloadLayer'\r\n    },\r\n\r\n    properties: {\r\n        // tips: {\r\n        //     default: null,\r\n        //     type: cc.Label,\r\n        //     displayName: 'tips文本标签'\r\n        // }\r\n        downloadProgress: {\r\n            default: null,\r\n            type: cc.ProgressBar,\r\n            displayName: 'downloadProgress下载进度条'\r\n        }\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        DialogBase.prototype.onLoad.call(this);\r\n        this.downloadState = false;\r\n        this.regEvent(AF.Event.FILE_DOWNLOAD, this.onFileDownloaded);\r\n    },\r\n    onEnable: function () {\r\n        DialogBase.prototype.onEnable.call(this);\r\n        //\r\n        this.workState = 0;\r\n        // 1 无下载任务 2 正在下载 3 下载完成 4 下载失败\r\n        this.currentState = 1;\r\n        this.currentIndex = -1;\r\n        this.fileList = AF.DIALOG_PARAMS();\r\n        this.downloadProgress.progress = 0;\r\n        this.percent = 0;\r\n    },\r\n\r\n    onDestroy: function () {\r\n        DialogBase.prototype.onDestroy.call(this);\r\n        this.currentState = 1;\r\n        this.currentIndex = -1;\r\n        this.downloadState = false;\r\n    },\r\n    show: function (isShow) {\r\n        var panel = this.node.getChildByName(\"panel\");\r\n        panel.opacity = isShow ? 255 : 0;\r\n    },\r\n    onFileDownloaded: function (filename, url, state) {\r\n        if (this.currentIndex < 0 || this.currentIndex >= this.fileList.length) {\r\n            return;\r\n        }\r\n        if (filename !== this.fileList[this.currentIndex]) {\r\n            return;\r\n        }\r\n        if (state) {\r\n            this.currentState = 3;\r\n        } else {\r\n            this.currentState = 4;\r\n        }\r\n    },\r\n    downloadFile: function () {\r\n        AF.Downloader.startDownloadFile(this.fileList[this.currentIndex], false);\r\n    },\r\n    update: function (dt) {\r\n        if (3 === this.workState) {\r\n            if (this.percent < 99) {\r\n                this.percent ++;\r\n                this.downloadProgress.progress = this.percent/100;\r\n            } else {\r\n                this.workState = 1;\r\n                this.downloadProgress.progress = 1;\r\n                //发射成功\r\n                this.downloadState = true;\r\n                this.close();\r\n            }\r\n            return;\r\n        }\r\n        if (0 !== this.workState) {\r\n            return;\r\n        }\r\n\r\n        if (this.percent < 99) {\r\n            this.percent ++;\r\n            this.downloadProgress.progress = this.percent/100;\r\n        }\r\n\r\n        if (1 === this.currentState) {\r\n            if (this.currentIndex + 1 > this.fileList.length - 1) {\r\n                this.workState = 3;\r\n            } else {\r\n                this.currentIndex++;\r\n                this.currentState = 2;\r\n                this.downloadFile();\r\n            }\r\n        } else if (2 === this.currentState) {\r\n            //if()\r\n        } else if (3 === this.currentState) {\r\n            this.currentState = 1;\r\n        } else if (4 === this.currentState) {\r\n            //下载失败\r\n            this.workState = 2;\r\n            //发射失败\r\n            this.downloadState = false;\r\n            this.close();\r\n        }\r\n    },\r\n    close: function () {\r\n        DialogBase.prototype.close.call(this);\r\n        AF.EventDispatcher.emit(AF.Event.DOWNLOADDIAGLOG_ON_CLOSE, this.downloadState);\r\n    }\r\n});\r\n"]}