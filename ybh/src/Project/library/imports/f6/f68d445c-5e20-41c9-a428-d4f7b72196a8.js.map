{"version":3,"sources":["../../../../../assets/framework/utils/assets/framework/utils/AF-shader-utils.js"],"names":["SHADER_STATE","cc","Enum","noraml","gray","ShaderUtils","shaderPrograms","init","shaderName","glProgram","GLProgram","vert","require","js","formatStr","frag","initWithString","sys","isNative","initWithVertexShaderByteArray","addAttribute","macro","ATTRIBUTE_NAME_POSITION","VERTEX_ATTRIB_POSITION","ATTRIBUTE_NAME_COLOR","VERTEX_ATTRIB_COLOR","ATTRIBUTE_NAME_TEX_COORD","VERTEX_ATTRIB_TEX_COORDS","link","updateUniforms","setShader","sprite","_sgNode","setShaderProgram","setState","AF","window","mixin","module","exports"],"mappings":";;;;;;AAAA;AACA,IAAMA,eAAeC,GAAGC,IAAH,CAAQ;AACzBC,YAAQ,CAAC,CADgB;AAEzBC,UAAM,CAAC;AAFkB,CAAR,CAArB;AAIA,IAAIC,cAAc;AACdC,oBAAgB,EADF;;AAGdC,UAAM,cAAUC,UAAV,EAAsB;;AAExB,YAAIC,YAAY,KAAKH,cAAL,CAAoBE,UAApB,CAAhB;AACA,YAAI,CAACC,SAAL,EAAgB;AACZA,wBAAY,IAAIR,GAAGS,SAAP,EAAZ;AACA,gBAAIC,OAAOC,QAAQX,GAAGY,EAAH,CAAMC,SAAN,CAAgB,SAAhB,EAA2BN,UAA3B,CAAR,CAAX;AACA,gBAAIO,OAAOH,QAAQX,GAAGY,EAAH,CAAMC,SAAN,CAAgB,SAAhB,EAA2BN,UAA3B,CAAR,CAAX;AACAC,sBAAUO,cAAV,CAAyBL,IAAzB,EAA+BI,IAA/B;AACA,gBAAI,CAACd,GAAGgB,GAAH,CAAOC,QAAZ,EAAsB;AAClBT,0BAAUU,6BAAV,CAAwCR,IAAxC,EAA8CI,IAA9C;AACAN,0BAAUW,YAAV,CAAuBnB,GAAGoB,KAAH,CAASC,uBAAhC,EAAyDrB,GAAGoB,KAAH,CAASE,sBAAlE;AACAd,0BAAUW,YAAV,CAAuBnB,GAAGoB,KAAH,CAASG,oBAAhC,EAAsDvB,GAAGoB,KAAH,CAASI,mBAA/D;AACAhB,0BAAUW,YAAV,CAAuBnB,GAAGoB,KAAH,CAASK,wBAAhC,EAA0DzB,GAAGoB,KAAH,CAASM,wBAAnE;AACH;AACDlB,sBAAUmB,IAAV;AACAnB,sBAAUoB,cAAV;AACA,iBAAKvB,cAAL,CAAoBE,UAApB,IAAkCC,SAAlC;AACH;AAEJ,KAtBa;;AAwBdqB,eAAW,mBAAUC,MAAV,EAAkBvB,UAAlB,EAA8B;AACrC,aAAKD,IAAL,CAAUC,UAAV;AACA,YAAIC,YAAY,KAAKH,cAAL,CAAoBE,UAApB,CAAhB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAuB,eAAOC,OAAP,CAAeC,gBAAf,CAAgCxB,SAAhC;AACAsB,eAAOC,OAAP,CAAeE,QAAf,CAAwBlC,aAAaQ,UAAb,CAAxB;AACA,eAAOC,SAAP;AACH;AA7Ca,CAAlB;;AAgDA;;AAEA,IAAI0B,KAAKC,OAAOD,EAAP,GAAYC,OAAOD,EAAP,IAAa,EAAlC;AACAA,GAAG9B,WAAH,GAAiB8B,GAAG9B,WAAH,IAAkB,EAAnC;AACAJ,GAAGY,EAAH,CAAMwB,KAAN,CAAYF,GAAG9B,WAAf,EAA4BA,WAA5B;;AAEAiC,OAAOC,OAAP,GAAiBlC,WAAjB","file":"AF-shader-utils.js","sourceRoot":"../../../../../assets/framework/utils","sourcesContent":["// ShaderUtils.js\r\nconst SHADER_STATE = cc.Enum({\r\n    noraml: -1,\r\n    gray: -1,\r\n});\r\nvar ShaderUtils = {\r\n    shaderPrograms: {},\r\n\r\n    init: function (shaderName) {\r\n\r\n        var glProgram = this.shaderPrograms[shaderName];\r\n        if (!glProgram) {\r\n            glProgram = new cc.GLProgram();\r\n            var vert = require(cc.js.formatStr(\"%s.vert\", shaderName));\r\n            var frag = require(cc.js.formatStr(\"%s.frag\", shaderName));\r\n            glProgram.initWithString(vert, frag);\r\n            if (!cc.sys.isNative) {\r\n                glProgram.initWithVertexShaderByteArray(vert, frag);\r\n                glProgram.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);\r\n                glProgram.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);\r\n                glProgram.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);\r\n            }\r\n            glProgram.link();\r\n            glProgram.updateUniforms();\r\n            this.shaderPrograms[shaderName] = glProgram;\r\n        }\r\n\r\n    },\r\n\r\n    setShader: function (sprite, shaderName) {\r\n        this.init(shaderName);\r\n        var glProgram = this.shaderPrograms[shaderName];\r\n        // if (!glProgram) {\r\n        //     glProgram = new cc.GLProgram();\r\n        //     var vert = require(cc.js.formatStr(\"%s.vert\", shaderName));\r\n        //     var frag = require(cc.js.formatStr(\"%s.frag\", shaderName));\r\n        //     glProgram.initWithString(vert, frag);\r\n        //     if (!cc.sys.isNative) {  \r\n        //         glProgram.initWithVertexShaderByteArray(vert, frag);\r\n        //         glProgram.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION, cc.macro.VERTEX_ATTRIB_POSITION);  \r\n        //         glProgram.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR, cc.macro.VERTEX_ATTRIB_COLOR);  \r\n        //         glProgram.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD, cc.macro.VERTEX_ATTRIB_TEX_COORDS);  \r\n        //     }\r\n        //     glProgram.link();  \r\n        //     glProgram.updateUniforms();\r\n        //     this.shaderPrograms[shaderName] = glProgram;\r\n        // }\r\n        sprite._sgNode.setShaderProgram(glProgram);\r\n        sprite._sgNode.setState(SHADER_STATE[shaderName]);\r\n        return glProgram;\r\n    },\r\n};\r\n\r\n//ShaderUtils.init(\"gray\");\r\n\r\nvar AF = window.AF = window.AF || {};\r\nAF.ShaderUtils = AF.ShaderUtils || {};\r\ncc.js.mixin(AF.ShaderUtils, ShaderUtils);\r\n\r\nmodule.exports = ShaderUtils;"]}