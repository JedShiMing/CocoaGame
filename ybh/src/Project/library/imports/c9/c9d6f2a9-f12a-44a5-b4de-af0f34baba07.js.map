{"version":3,"sources":["../../../../../../assets/hall/ui/widget/assets/hall/ui/widget/PlayerPrefab.js"],"names":["cc","Class","extends","Component","properties","heroShadow","default","type","Node","displayName","userTips","loadEffectNode","playerNode","effectNode","effectBgNode","hudunNode","faintNode","nickNameNode","effectPrefab","Prefab","defaultDuration","range","loadEffect","tooltip","rolename","Label","floatNode","expProgressPre","onLoad","listen","listenFilename","_isMoving","durationTime","zOrderDelegate","runAudioDuration","runAudioInterval","Math","random","tPos","v2","_isLoaded","flipX","playerScale","defaultAction","actionType","repeatCount","Infinity","frameIndex","as","currentActionIndex","currentActionLoop","actionList","actionLoop","floatLabel","labelInitX","labelXArr","actions","sprPlayer","getComponent","Sprite","aniAction","Animation","anistate","dead","on","onFinished","_loadFontRes","schedule","_updatePos","_updateFloatLabel","_updateLarge","active","last_float_ms","currentLarge","nextLarge","hudunEffect","faintEffect","AF","EventDispatcher","Event","FILE_LOADFRAME","onLoadFrameEnded","self","loader","loadRes","BitmapFont","err","bmFont","fontRoomSmall","fontWin","doMove","duration","name","isMoving","playAction","createEffect","isBg","effect","util","createPrefabNode","comp","addChild","effectMgr","push","setFlipX","scale","getLargeScale","scaleX","scaleY","getFlipX","getPlayerScale","getBodyPosition","pt","x","y","cfi","GameConfig","getPlayerInfo","playerId","chest","head","setPlayerID","clearUI","model","key","hasOwnProperty","deepCopy","body","setPosition","setUserTips","setHeroShadow","defaultPoise","showAction","show","Frameloader","startLoadFile","getPlayerSprite","setNickName","offsetY","fontSize","color","Color","nickNameLabel","lineHeight","string","cutstr","disableNickName","setRoleName","setPlayerAnchor","anchorX","anchorY","setLoadEffect","visable","stopAction","stop","playDefaultPoise","playSingleFrame","loop","obj","playActions","node","i","length","_playAni","isLoaded","showFloatLabel","content","cs","clearListen","clips","getClips","removeClip","onDestroy","off","createClip","actionInfo","actionName","action","error","frames","spriteFrame","clip","AnimationClip","createWithSpriteFrames","rate","wrapMode","WrapMode","Loop","Normal","sample","speed","addClip","play","playerName","succ","Const","ActionName","onPlayNextAction","currentAction","event","dt","SPLIT","this_float_ms","getCurrTime","lableInfo","splice","label","opacity","text","addComponent","isSystemFontUsed","font","overflow","Overflow","NONE","str","js","formatStr","dir","abs","offsetX","spawn","moveBy","fadeOut","bezierTo","scaleTo","easing","easeBackOut","fadeIn","doStop","delayTime","disappear","callFunc","doDestroy","destroy","act","sequence","runAction","setZOrderDelegate","delegate","setZOrder","zIndex","getPlayerZOrder","getZOrder","dx","dy","setDead","clearFaint","clearHudun","pos","followPlayerScale","setLarge","large","getLevelupEffectInfo","pNode","index","effectComp","getChildByName","checkWorking","newEffect","instantiate","setAnchorPoint","playLevelupAni","fgEffectInfo","fgEffectName","levelupFgEffect","bgEffectInfo","bgEffectName","levelupBgEffect","doStart","setNodeName","setExpProgressY","posY","expProgressNode","showGain","gainInfo","maxDelayTime","stopAllActions","init","target","args","list","showExp","showHudun","is_hudun","showFaint","is_faint"],"mappings":"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","file":"PlayerPrefab.js","sourceRoot":"../../../../../../assets/hall/ui/widget","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        heroShadow: {\r\n            default: null,\r\n            type: cc.Node,\r\n            displayName: \"英雄影子\"\r\n        },\r\n        userTips: {\r\n            default: null,\r\n            type: cc.Node,\r\n            displayName: \"头上标签\"\r\n        },\r\n        loadEffectNode: {\r\n            default: null,\r\n            type: cc.Node,\r\n            displayName: \"加载节点\"\r\n        },\r\n        playerNode: {\r\n            default: null,\r\n            type: cc.Node,\r\n            displayName: \"英雄动画节点\"\r\n        },\r\n        effectNode: {\r\n            default: null,\r\n            type: cc.Node,\r\n            displayName: \"特效挂载点\"\r\n        },\r\n        effectBgNode: {\r\n            default: null,\r\n            type: cc.Node,\r\n            displayName: \"特效挂载点(背面)\"\r\n        },\r\n        hudunNode: {\r\n            default: null,\r\n            type: cc.Node,\r\n            displayName: \"hudun挂载点\"\r\n        },\r\n        faintNode: {\r\n            default: null,\r\n            type: cc.Node,\r\n            displayName: \"faint挂载点\"\r\n        },\r\n        nickNameNode: {\r\n            default: null,\r\n            type: cc.Node,\r\n            displayName: \"昵称\"\r\n        },\r\n\r\n        effectPrefab: {\r\n            default: null,\r\n            type: cc.Prefab,\r\n            displayName: \"特效预制件\"\r\n        },\r\n        defaultDuration: {\r\n            default: 0.8,\r\n            displayName: \"持续时间\",\r\n            range: [0.5, 1.5]\r\n        },\r\n        loadEffect: {\r\n            default: false,\r\n            displayName: \"启用/关闭加载效果\",\r\n            tooltip: \"启用/关闭 加载效果\",\r\n        },\r\n        rolename: cc.Label,\r\n        floatNode: cc.Node,\r\n\r\n        expProgressPre: cc.Prefab,\r\n    },\r\n\r\n    onLoad: function () {\r\n        this.listen = false;\r\n        this.listenFilename = \"\";\r\n\r\n        this._isMoving = false;\r\n        this.durationTime = 0;\r\n\r\n        this.zOrderDelegate = null;\r\n\r\n        this.runAudioDuration = 0;\r\n        this.runAudioInterval = (0.8 + (Math.random() * 3) / 10);\r\n\r\n        this.tPos = cc.v2(0, 0);\r\n\r\n        this._isLoaded = false;\r\n        this.flipX = false;\r\n        this.playerScale = 1;\r\n\r\n        this.defaultAction = { actionType: \"wait\", repeatCount: Infinity, frameIndex: 0, as: 100 };\r\n        this.currentActionIndex = 0;\r\n        this.currentActionLoop = 1;\r\n\r\n        this.actionList = [];//{actionType: 动作名,repeatCount:次数, frameIndex: 静态图帧数设定 从1开始 }\r\n        this.actionLoop = false;\r\n\r\n\r\n        this.floatLabel = [];\r\n        this.labelInitX = 0;\r\n        this.labelXArr = [10, 20];\r\n\r\n        this.actions = {};\r\n        this.sprPlayer = this.playerNode.getComponent(cc.Sprite);\r\n        this.aniAction = this.playerNode.getComponent(cc.Animation);\r\n        this.anistate;\r\n\r\n        this.dead = false;\r\n\r\n        this.aniAction.on('finished', this.onFinished, this);\r\n\r\n\r\n        this._loadFontRes();\r\n        this.schedule(this._updatePos, 0, this);\r\n        this.schedule(this._updateFloatLabel, 0, this);\r\n        this.schedule(this._updateLarge, 0.03, this);\r\n        this.loadEffectNode.active = this.loadEffect;\r\n\r\n        this.last_float_ms = 0;\r\n\r\n        this.currentLarge = 0;\r\n        this.nextLarge = -1;\r\n\r\n        this.hudunEffect = null;\r\n\r\n        this.faintEffect = null;\r\n\r\n        AF.EventDispatcher.on(AF.Event.FILE_LOADFRAME, this.onLoadFrameEnded, this);\r\n    },\r\n\r\n    _loadFontRes: function () {\r\n        var self = this;\r\n        cc.loader.loadRes(\"hall/font/FontRoomSmall\", cc.BitmapFont, function (err, bmFont) {\r\n            self.fontRoomSmall = bmFont;\r\n        });\r\n        cc.loader.loadRes(\"hall/font/FontWin\", cc.BitmapFont, function (err, bmFont) {\r\n            self.fontWin = bmFont;\r\n        });\r\n    },\r\n\r\n    doMove: function (duration, tPos) {\r\n        this.durationTime += duration;\r\n        this.tPos = tPos;\r\n        if (this.anistate && \"run\" === this.anistate.name) {\r\n        } else if (!this.isMoving()) {\r\n            this.playAction(\"run\", true);\r\n        }\r\n        this._isMoving = true;\r\n    },\r\n\r\n    createEffect: function (isBg) {\r\n        var effect = AF.util.createPrefabNode(this.effectPrefab);\r\n        var comp = null;\r\n        if (isBg) {\r\n            this.effectBgNode.addChild(effect);\r\n            comp = effect.getComponent(\"EffectPrefab\");\r\n            this.effectMgr[0].push(comp);\r\n        } else {\r\n            this.effectNode.addChild(effect);\r\n            comp = effect.getComponent(\"EffectPrefab\");\r\n            this.effectMgr[1].push(comp);\r\n        }\r\n        return comp;\r\n    },\r\n\r\n    setFlipX: function (flipX) {\r\n\r\n        var scale = this.playerScale;\r\n        scale *= this.getLargeScale();\r\n\r\n        if (flipX) {\r\n            this.playerNode.scaleX = -1 * scale;\r\n        } else {\r\n            this.playerNode.scaleX = scale;\r\n        }\r\n\r\n        this.playerNode.scaleY = scale;\r\n        this.flipX = flipX;\r\n    },\r\n\r\n    getFlipX: function () {\r\n        return this.flipX;\r\n    },\r\n\r\n    getPlayerScale: function () {\r\n        return this.playerScale;\r\n    },\r\n\r\n    getBodyPosition(pt) {\r\n\r\n        var x = 0;\r\n        var y = 0;\r\n\r\n        var cfi = AF.GameConfig.getPlayerInfo(this.playerId);\r\n\r\n        if (cfi) {\r\n            if (pt == 1) {\r\n                x = cfi.chest.x;\r\n                y = cfi.chest.y;\r\n            } else if (pt == 2) {\r\n                x = cfi.head.x;\r\n                y = cfi.head.y;\r\n            }\r\n        }\r\n\r\n        var scale = this.playerScale;\r\n\r\n        scale *= this.getLargeScale();\r\n\r\n        x = x * scale;\r\n        y = y * scale;\r\n\r\n        return { x: x, y: y };\r\n    },\r\n\r\n    setPlayerID: function (playerId) {\r\n        // if (\"undefined\" === typeof this.sprPlayer || \"undefined\" === this.aniAction) {\r\n        //     this.onLoad();\r\n        // }\r\n\r\n\r\n        this.clearUI();\r\n        var cfi = AF.GameConfig.getPlayerInfo(playerId);\r\n        if (!cfi) {\r\n            return;\r\n        }\r\n        this.playerScale = cfi.scale;\r\n        this.playerNode.scale = this.playerScale;\r\n        this.playerId = playerId;\r\n        this.listenFilename = cfi.model;\r\n        for (const key in cfi.actions) {\r\n            if (cfi.actions.hasOwnProperty(key)) {\r\n                this.actions[key] = AF.util.deepCopy(cfi.actions[key], {});\r\n            }\r\n        }\r\n        // this.actions\r\n        this.head = cfi.head || { x: 0, y: 0 };\r\n        this.body = cfi.chest || { x: 0, y: 0 };\r\n        this.userTips.setPosition(this.head.x, this.head.y + 15);\r\n\r\n        this.setUserTips(false);\r\n        this.setHeroShadow(true);\r\n\r\n        this.nickNameNode.active = false;\r\n\r\n        this.defaultPoise = { showAction: cfi.showAction, show: cfi.show };\r\n        // this.playerNode.y = -1 * this.foot;\r\n        AF.Frameloader.startLoadFile(this.listenFilename, 2);\r\n    },\r\n\r\n    getPlayerSprite: function () {\r\n        return this.sprPlayer;\r\n    },\r\n\r\n    setNickName: function (name, offsetY, fontSize, color) {\r\n        if (\"\" === name) {\r\n            this.nickNameNode.active = false;\r\n            return;\r\n        }\r\n        this.nickNameNode.active = true;\r\n        var offsetY = offsetY || 10;\r\n        var fontSize = fontSize || 40;\r\n        var color = color || new cc.Color(0, 0, 0);\r\n\r\n        this.nickNameNode.setPosition(cc.v2(this.head.x, offsetY));\r\n        this.nickNameNode.color = color;\r\n\r\n        var nickNameLabel = this.nickNameNode.getComponent(cc.Label);\r\n\r\n        nickNameLabel.fontSize = fontSize;\r\n        nickNameLabel.lineHeight = fontSize;\r\n        nickNameLabel.string = AF.util.cutstr(name, 8);\r\n    },\r\n\r\n    disableNickName: function () {\r\n        this.nickNameNode.active = false;\r\n    },\r\n\r\n    setRoleName: function (name) {\r\n        // if (name.length > 8) {\r\n        //     var str = \"\";\r\n        //     for (let i = 0; i < 8; i++) {\r\n        //         str += name[i];\r\n        //     }\r\n\r\n        //     name = str;\r\n        // }\r\n\r\n        // if (name == \"\") {\r\n        //     return;\r\n        // }\r\n        this.rolename.string = AF.util.cutstr(name, 8);\r\n    },\r\n\r\n    setPlayerAnchor: function (x, y) {\r\n        this.playerNode.anchorX = x;\r\n        this.playerNode.anchorY = y;\r\n    },\r\n\r\n    setLoadEffect: function (visable) {\r\n        this.loadEffect = visable;\r\n        if (!this._isLoaded) {\r\n            this.loadEffectNode.active = this.loadEffect;\r\n        }\r\n    },\r\n\r\n    stopAction: function () {\r\n        if (this.aniAction) {\r\n            this.aniAction.stop();\r\n        }\r\n    },\r\n\r\n    playDefaultPoise: function () {\r\n        this.playAction(this.defaultPoise.showAction, true, this.defaultPoise.show);\r\n    },\r\n    playSingleFrame: function (actionType, frameIndex) {\r\n        this.playAction(actionType, true, frameIndex);\r\n    },\r\n\r\n    /*\r\n    this.actionLoop = false;\r\n        this.actionList = [];\r\n        this.currentActionIndex = 0;\r\n        this.currentActionLoop = 1;\r\n    */\r\n\r\n    playAction: function (actionType, loop, frameIndex) {\r\n        var frameIndex = frameIndex || 0;\r\n        var loop = loop || false;\r\n\r\n        var obj = {};\r\n        obj.actionType = actionType;\r\n        obj.frameIndex = frameIndex;\r\n        obj.repeatCount = 1;\r\n\r\n        if (loop) {\r\n            obj.repeatCount = Infinity;\r\n        }\r\n\r\n        var actions = [];\r\n        actions.push(obj);\r\n\r\n        this.playActions(actions, false);\r\n    },\r\n    //actions =[{actionType: 动作名,frameIndex:帧, repeatCount:次数 }]\r\n    playActions: function (actions, loop) {\r\n\r\n        if (this.isMoving()) {\r\n            this.node.x = this.tPos.x;\r\n            this.node.y = this.tPos.y;\r\n            this._isMoving = false;\r\n        }\r\n\r\n        this.actionList = [];\r\n\r\n        for (let i = 0; i < actions.length; i++) {\r\n            var obj = {};\r\n            obj.actionType = actions[i].actionType;\r\n            obj.frameIndex = actions[i].frameIndex || 0;\r\n            obj.repeatCount = actions[i].repeatCount || 1;\r\n            obj.as = actions[i].as || 100;\r\n\r\n            this.actionList.push(obj);\r\n        }\r\n\r\n        this.actionLoop = loop;\r\n\r\n        this.currentActionIndex = 0;\r\n        this.currentActionLoop = 1;\r\n\r\n        this._playAni();\r\n    },\r\n\r\n    isLoaded: function () {\r\n        return this._isLoaded;\r\n    },\r\n\r\n    isMoving: function () {\r\n        return this._isMoving;\r\n    },\r\n\r\n    showFloatLabel: function (content, type, cs) {\r\n        type = type || 0\r\n        this.floatLabel.push({ content: content, type: type, cs: cs });\r\n    },\r\n\r\n    clearUI: function () {\r\n        this.clearListen();\r\n        this.loadEffectNode.active = this.loadEffect;\r\n\r\n        this._isMoving = false;\r\n        this.durationTime = 0;\r\n\r\n        this.runAudioDuration = 0;\r\n\r\n        this.tPos = cc.v2(0, 0);\r\n\r\n        this._isLoaded = false;\r\n        this.flipX = false;\r\n\r\n        this.floatLabel = [];\r\n        this.labelInitX = 0;\r\n        this.labelXArr = [10, 20];\r\n\r\n        this.actions = [];\r\n\r\n        this.setFlipX(false);\r\n        var clips = this.aniAction.getClips();\r\n        for (let i = 0; i < clips.length; i++) {\r\n            this.aniAction.removeClip(clips[i], true);\r\n        }\r\n\r\n\r\n    },\r\n\r\n    onDestroy: function () {\r\n        this.clearListen();\r\n        this.aniAction.off('finished', this.onFinished, this);\r\n        AF.EventDispatcher.off(AF.Event.FILE_LOADFRAME, this.onLoadFrameEnded, this);\r\n    },\r\n\r\n    createClip: function () {\r\n\r\n        var clips = this.aniAction.getClips();\r\n        for (let i = 0; i < clips.length; i++) {\r\n            this.aniAction.removeClip(clips[i], true);\r\n        }\r\n        var actionInfo = this.actionList[this.currentActionIndex];\r\n        var actionName = actionInfo.actionType;\r\n        var action = this.actions[actionName];\r\n        if (!action) {\r\n            cc.error(this.playerId + '的' + actionName + '不存在');\r\n            actionName = 'wait';\r\n            action = this.actions[actionName];\r\n        }\r\n        this.setPlayerAnchor(action.x, action.y);\r\n        var frames = [];\r\n        if (!action.frames || action.frames.length <= 0) {\r\n            cc.error(\"palyerId:\" + this.playerId + \"的\" + actionName + \"动作缺失!,播放wait动作替代!\");\r\n            actionName = 'wait';\r\n            action = this.actions[actionName];\r\n        }\r\n        if (0 < actionInfo.frameIndex && actionInfo.frameIndex <= action.frames.length) {\r\n            frames[0] = action.frames[actionInfo.frameIndex - 1];\r\n        } else {\r\n            frames = action.frames;\r\n        }\r\n\r\n        if (actionInfo.frameIndex == -1) {\r\n            if (action.frames.length > 0) {\r\n                frames = [];\r\n                frames.push(action.frames[action.frames.length - 1]);\r\n            }\r\n        }\r\n\r\n\r\n        if (frames.length <= 0) {\r\n            frames = this.actions[\"wait\"].frames;\r\n        }\r\n\r\n        this.sprPlayer.spriteFrame = frames[0];\r\n        var clip = cc.AnimationClip.createWithSpriteFrames(frames, action.rate);\r\n        clip.name = actionName;\r\n        if (Infinity === actionInfo.repeatCount) {\r\n            clip.wrapMode = cc.WrapMode.Loop;\r\n        } else {\r\n            clip.wrapMode = cc.WrapMode.Normal;\r\n        }\r\n        clip.sample = 10;\r\n        clip.speed = actionInfo.as / 100;\r\n        this.aniAction.addClip(clip, actionName);\r\n        return this.aniAction.play(actionName);\r\n    },\r\n\r\n    onLoadFrameEnded: function (playerName, frames, succ) {\r\n        if (this.listenFilename !== playerName) {\r\n            return;\r\n        }\r\n        this.clearListen();\r\n\r\n        if (!succ) {\r\n            cc.error('onLoadFrameEnded fail');\r\n            return;\r\n        }\r\n\r\n        for (let i = 1; i <= AF.Const.ActionName.length - 1; i++) {\r\n            var actionType = AF.Const.ActionName[i];\r\n            this.actions[actionType].frames = [];\r\n            this.actions[actionType].frames = frames[i];\r\n        }\r\n\r\n        //this.node.active = true;\r\n        this.loadEffectNode.active = false;\r\n        this._isLoaded = true;\r\n        if (this.actionList.length <= 0) {\r\n            this.actionList.push(this.defaultAction);\r\n            this.currentActionIndex = 0;\r\n            this.currentActionLoop = 1;\r\n        }\r\n        this._playAni();\r\n    },\r\n\r\n    onPlayNextAction: function () {\r\n\r\n        var currentAction = this.actionList[this.currentActionIndex];\r\n\r\n        if (Infinity === currentAction.repeatCount) {\r\n            return;\r\n        }\r\n\r\n        if (this.currentActionLoop < currentAction.repeatCount) {\r\n            this.currentActionLoop++;\r\n            return;\r\n        }\r\n\r\n        this.currentActionIndex++;\r\n        this.currentActionLoop = 1;\r\n\r\n        if (this.currentActionIndex >= this.actionList.length) {\r\n            if (this.actionLoop) {\r\n                this.currentActionIndex = 0;\r\n                this.currentActionLoop = 1;\r\n            } else {\r\n                this.actionList = [];\r\n                this.actionList.push(this.defaultAction);\r\n                this.currentActionIndex = 0;\r\n                this.currentActionLoop = 1;\r\n            }\r\n        }\r\n    },\r\n\r\n    onFinished: function (event) {\r\n        if (this.dead && this.anistate.name === \"dead\") {\r\n            this.playSingleFrame(\"dead\", -1);\r\n        } else {\r\n            this.onPlayNextAction();\r\n            this._playAni();\r\n        }\r\n    },\r\n\r\n    _playAni: function () {\r\n        if (!this.isLoaded()) return;\r\n        this.stopAction();\r\n        this.anistate = this.createClip();\r\n    },\r\n\r\n    _updateFloatLabel: function (dt) {\r\n\r\n        if (this.floatLabel.length <= 0) {\r\n            return;\r\n        }\r\n\r\n        var SPLIT = 300;\r\n\r\n        var this_float_ms = AF.util.getCurrTime();\r\n\r\n        if (this_float_ms <= this.last_float_ms + SPLIT) {\r\n            return;\r\n        }\r\n\r\n        var lableInfo = this.floatLabel[0];\r\n        this.floatLabel.splice(0, 1);\r\n\r\n        var label = new cc.Node();\r\n        label.scale = 0.1;\r\n        label.opacity = 0;\r\n        var text = label.addComponent(cc.Label);\r\n        text.isSystemFontUsed = false;\r\n        text.font = this.fontWin;\r\n        text.overflow = cc.Label.Overflow.NONE;\r\n\r\n        //var outline = label.addComponent(cc.LabelOutline);\r\n        //outline.width = 0.8;\r\n\r\n        //根据type来修改内容\r\n\r\n        var str = cc.js.formatStr(\"%d\", lableInfo.content);\r\n\r\n        if (lableInfo.content > 0) {\r\n            str = \"+\" + str;\r\n        }\r\n\r\n        if (lableInfo.content > 0) {\r\n            text.fontSize = 36;\r\n            label.color = cc.color(95, 201, 34);\r\n\r\n            if (lableInfo.cs) {\r\n                text.fontSize *= 1.2;\r\n            }\r\n        } else {\r\n            text.fontSize = 36;\r\n            label.color = cc.color(255, 255, 0);\r\n            if (lableInfo.cs) {\r\n                text.fontSize *= 1.2;\r\n                label.color = cc.color(255, 25, 7);\r\n            }\r\n        }\r\n\r\n        text.lineHeight = text.fontSize + 6;\r\n        //outline.color = label.color;\r\n\r\n        text.string = str;\r\n        this.labelInitX++;\r\n        this.labelInitX %= this.labelXArr.length;\r\n        var dir = (Math.abs(this.playerNode.scaleX) / this.playerNode.scaleX) * -1;\r\n        var offsetX = this.labelXArr[this.labelInitX] * dir;\r\n        label.setPosition(cc.v2(this.head.x + offsetX, this.head.y + 30));\r\n        this.floatNode.addChild(label, 100);\r\n\r\n        this.last_float_ms = this_float_ms;\r\n\r\n        var self = this;\r\n        var actions = [];\r\n\r\n        if (lableInfo.type == 1) {\r\n            label.setPosition(cc.v2(this.head.x, this.head.y + 30));\r\n            label.scale = 1;\r\n            label.opacity = 255;\r\n            var show = cc.spawn(\r\n                cc.moveBy(1.0, cc.v2(0, 100)),\r\n                cc.fadeOut(1.0)\r\n            );\r\n            actions.push(show);\r\n\r\n        } else {\r\n            var show = cc.spawn(\r\n                cc.bezierTo(0.5, [\r\n                    cc.v2(this.head.x + offsetX + dir * 5, this.head.y + 50),\r\n                    cc.v2(this.head.x + offsetX + dir * 10, this.head.y + 100),\r\n                    cc.v2(this.head.x + offsetX + dir * 15, this.head.y + 40)]),\r\n                cc.scaleTo(0.5, 0.8).easing(cc.easeBackOut()),\r\n                cc.fadeIn(0.3),\r\n            );\r\n            actions.push(show);\r\n\r\n            var doStop = cc.delayTime(1.0 / 60.0);\r\n            actions.push(doStop);\r\n\r\n            var disappear = cc.spawn(\r\n                cc.callFunc(function () {\r\n                }),\r\n                cc.scaleTo(self.defaultDuration, 0.5).easing(cc.easeBackOut()),\r\n                cc.fadeOut(self.defaultDuration),\r\n            );\r\n            actions.push(disappear);\r\n        }\r\n\r\n\r\n\r\n        var doDestroy = cc.callFunc(function () {\r\n            label.destroy();\r\n        });\r\n        actions.push(doDestroy);\r\n\r\n        var act = cc.sequence(actions);\r\n        label.runAction(act);\r\n    },\r\n\r\n    setUserTips: function (active) {\r\n        this.userTips.active = active;\r\n    },\r\n\r\n    setHeroShadow: function (active) {\r\n        this.heroShadow.active = active;\r\n    },\r\n\r\n    setZOrderDelegate: function (delegate) {\r\n        this.zOrderDelegate = delegate;\r\n    },\r\n\r\n    setZOrder: function () {\r\n        if (this.zOrderDelegate) {\r\n            this.node.zIndex = this.zOrderDelegate.getPlayerZOrder(this.node.y);\r\n        }\r\n    },\r\n\r\n    getZOrder: function () {\r\n        return this.node.zIndex;\r\n    },\r\n\r\n    _updatePos: function (dt) {\r\n        if (!this.isMoving()) return;\r\n        if (this.durationTime <= dt) {\r\n            this._isMoving = false;\r\n            this.node.x = this.tPos.x;\r\n            this.node.y = this.tPos.y;\r\n            this.durationTime = 0;\r\n            //恢复默认动作\r\n            this.actionList = [];\r\n            this.actionList.push(this.defaultAction);\r\n            this.currentActionIndex = 0;\r\n            this.currentActionLoop = 1;\r\n            this._playAni();\r\n            return;\r\n        }\r\n        var speed = dt / this.durationTime;\r\n        var dx = (this.tPos.x - this.node.x) * speed;\r\n        var dy = (this.tPos.y - this.node.y) * speed;\r\n        this.node.x += dx;\r\n        this.node.y += dy;\r\n        this.setZOrder();\r\n        if (dx < 0) {\r\n            this.setFlipX(true);\r\n        } else if (dx > 0) {\r\n            this.setFlipX(false);\r\n        }\r\n        this.durationTime -= dt;\r\n\r\n        this.runAudioDuration += dt;\r\n        if (this.runAudioDuration >= this.runAudioInterval) {\r\n            this.runAudioDuration = 0;\r\n        }\r\n    },\r\n\r\n    setDead: function (dead) {\r\n        this.dead = dead;\r\n\r\n        if (this.dead) {\r\n            this.clearFaint();\r\n            this.clearHudun();\r\n        }\r\n    },\r\n\r\n    clearListen: function () {\r\n        this.listenFilename = null;\r\n    },\r\n\r\n    _updateLarge: function (dt) {\r\n        if (this.nextLarge == -1) {\r\n            return;\r\n        }\r\n\r\n        if (this.currentLarge > this.nextLarge) {\r\n            this.currentLarge--;\r\n        } else if (this.currentLarge < this.nextLarge) {\r\n            this.currentLarge++;\r\n        }\r\n\r\n        var pos = this.getBodyPosition(2);\r\n\r\n        this.followPlayerScale(this.hudunEffect);\r\n        this.followPlayerScale(this.faintEffect);\r\n\r\n        this.setFlipX(this.flipX);\r\n\r\n        if (this.currentLarge == this.nextLarge) {\r\n            this.nextLarge = -1;\r\n        }\r\n    },\r\n\r\n    getLargeScale: function () {\r\n        return 1 + this.currentLarge * 0.02;\r\n    },\r\n\r\n    setLarge: function (large) {\r\n        this.nextLarge = large * 5;\r\n    },\r\n\r\n    getLevelupEffectInfo: function (pNode, name) {\r\n        var index = 1;\r\n        var effectComp = null;\r\n        while (true) {\r\n            let effect = pNode.getChildByName(name + index);\r\n            if (!effect) { break; }\r\n\r\n            let comp = effect.getComponent('EffectPrefab');\r\n            if (!comp) { break; }\r\n\r\n            if (!comp.checkWorking()) {\r\n                effectComp = comp;\r\n                break;\r\n            }\r\n            index++;\r\n        }\r\n        if (!effectComp) {\r\n            var newEffect = cc.instantiate(this.effectPrefab);\r\n            newEffect.setAnchorPoint(0.5, 0);\r\n            newEffect.y = 45;\r\n            pNode.addChild(newEffect, 1, name + index);\r\n            effectComp = newEffect.getComponent('EffectPrefab');\r\n        }\r\n        return { comp: effectComp, name: name + index };\r\n    },\r\n\r\n    playLevelupAni: function () {\r\n\r\n        let fgEffectInfo = this.getLevelupEffectInfo(this.effectNode, 'playerlevelupfg');\r\n        let fgEffectName = fgEffectInfo.name;\r\n        let levelupFgEffect = fgEffectInfo.comp;\r\n        levelupFgEffect.setFlipX(this.flipX);\r\n\r\n        let bgEffectInfo = this.getLevelupEffectInfo(this.effectBgNode, 'playerlevelupbg');\r\n        let bgEffectName = bgEffectInfo.name;\r\n        let levelupBgEffect = bgEffectInfo.comp;\r\n        levelupBgEffect.setFlipX(this.flipX);\r\n\r\n        levelupFgEffect.doStart('playerlevelupfg', 1, 1, 20, null, 0);\r\n        levelupBgEffect.doStart('playerlevelupbg', 1, 1, 20, null, 0);\r\n\r\n        levelupFgEffect.setNodeName(fgEffectName);\r\n        levelupBgEffect.setNodeName(bgEffectName);\r\n    },\r\n\r\n    setExpProgressY: function (posY) {\r\n        let expProgressNode = this.node.getChildByName('expProgressNode');\r\n        if (!expProgressNode) {\r\n            return;\r\n        }\r\n        expProgressNode.getComponent(\"ProgressBasePrefab\").setExpProgressY(posY);\r\n    },\r\n\r\n    showGain: function (gainInfo, maxDelayTime) {\r\n        let expProgressNode = this.node.getChildByName('expProgressNode');\r\n        if (!expProgressNode) {\r\n            expProgressNode = cc.instantiate(this.expProgressPre);\r\n            this.node.addChild(expProgressNode, 1, 'expProgressNode');\r\n        } else {\r\n            expProgressNode.stopAllActions();\r\n            expProgressNode.getComponent(\"ProgressBasePrefab\").init();\r\n            expProgressNode.active = true;\r\n        }\r\n\r\n        let actions = [];\r\n        actions.push(cc.callFunc(function (target, args) {\r\n            target.getComponent(\"ProgressBasePrefab\").showGain(gainInfo);\r\n        }));\r\n        actions.push(cc.delayTime(1.0));\r\n        if (gainInfo.list.length > 0) {\r\n            let list = gainInfo.list;\r\n            actions.push(cc.callFunc(function (target, args) {\r\n                target.getComponent(\"ProgressBasePrefab\").showExp(list);\r\n            }));\r\n            actions.push(cc.delayTime(maxDelayTime + 2.0));\r\n        }\r\n        actions.push(cc.callFunc(function (target, args) {\r\n            target.active = false;\r\n        }));\r\n        expProgressNode.runAction(cc.sequence(actions));\r\n    },\r\n\r\n    showHudun: function (is_hudun) {\r\n\r\n        if (is_hudun) {\r\n            if (!this.hudunEffect) {\r\n                var effect = AF.util.createPrefabNode(this.effectPrefab);\r\n                this.hudunNode.addChild(effect);\r\n                var pt = this.getBodyPosition(1);\r\n                /*(265 / 2 - 37) / 265 => 37:泡泡盾距离中心点Y轴偏差,265:泡泡盾大小*/\r\n                effect.getChildByName('effectAni').setAnchorPoint(0.5, (265 / 2 - 37) / 265);\r\n                effect.setPosition(2 - pt.x, 0);\r\n                if (this.getFlipX()) {\r\n                    effect.setPosition(pt.x - 2, 0);\r\n                }\r\n                effect.getComponent(\"EffectPrefab\").doStart('paopaodun', 1, Infinity, null, null, null);\r\n                this.hudunEffect = effect;\r\n            }\r\n            this.hudunEffect.active = true;\r\n            this.followPlayerScale(this.hudunEffect);\r\n        } else {\r\n            this.clearHudun();\r\n        }\r\n    },\r\n\r\n    showFaint: function (is_faint) {\r\n\r\n        if (is_faint) {\r\n            this.playSingleFrame(\"wait\", 1);\r\n\r\n            if (!this.faintEffect) {\r\n                var effect = AF.util.createPrefabNode(this.effectPrefab);\r\n                this.faintNode.addChild(effect);\r\n                var pt = this.getBodyPosition(2);\r\n\r\n                pt.x -= 8;\r\n                pt.y += 35;\r\n                if (this.getFlipX()) {\r\n                    pt.x = 0 - pt.x\r\n                }\r\n\r\n                effect.setPosition(pt);\r\n                effect.getComponent(\"EffectPrefab\").doStart('faint', 1, Infinity, null, null, null);\r\n                this.faintEffect = effect;\r\n            }\r\n            this.faintEffect.active = true;\r\n            this.followPlayerScale(this.faintEffect);\r\n        } else {\r\n            this.playAction(\"wait\", true);\r\n            this.clearFaint();\r\n        }\r\n    },\r\n\r\n    clearFaint: function () {\r\n        if (this.faintEffect) {\r\n            this.faintEffect.active = false;\r\n        }\r\n    },\r\n\r\n    clearHudun: function () {\r\n        if (this.hudunEffect) {\r\n            this.hudunEffect.active = false;\r\n        }\r\n    },\r\n\r\n    followPlayerScale: function (node) {\r\n\r\n        var scale = this.playerScale;\r\n\r\n        scale *= this.getLargeScale();\r\n\r\n        if (node) {\r\n            node.scale = scale;\r\n        }\r\n    },\r\n\r\n});\r\n"]}